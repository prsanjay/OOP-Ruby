<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
	<title>The Ruby Language</title>
	<link rel="stylesheet" href="includes/styles.css" type="text/css" media="all">
</head>
<body>
<div id="header">
	<h1>Programming Ruby</h1>
	<h2>The Pragmatic Programmer's Guide</h2>
</div><div id="menutop" class="menu">
	<a href="ext_ruby.html" class="prev">&lt; Previous</a><a href="classes.html" class="next">Next &gt;</a>
	<a href="frameset.html" class="contents" target="_top">^Contents^</a>
</div><script type="text/javascript">
	top.frames.toc && top.frames.toc.SyncChanges && top.frames.toc.SyncChanges(null,'language',location.hash);
	top.document.title=document.title+' @ Programming Ruby';
</script>


<h1 id="therubylanguage">The Ruby Language</h1>
<p>This chapter is a bottom-up look at the Ruby language. Unlike the previous tutorial, here we're concentrating on presenting facts, rather than motivating some of the language design features. We also ignore the built-in classes and modules where possible. These are covered in depth in Chapter 22, &ldquo;<a href="builtins.html">Built-in Classes</a>&rdquo;.</p>
<p>If the content of this chapter looks familiar, it's because it should; we've covered just about all of this in the earlier tutorial chapters. Consider this chapter to be a self-contained reference to the core Ruby language.</p>

<h2 id="sourcelayout">Source Layout</h2>
<p>Ruby programs are written in 7-bit ASCII. <span class="footnote">(Ruby also has extensive support for Kanji, using the EUC, SJIS, or UTF-8 coding system. If a   code set   other than 7-bit ASCII is used, the <code>KCODE</code> option must be set appropriately, as shown in <a href="rubyworld.html#commandlineoptions">the section on command-line options</a>.)</span></p>
<p>Ruby is a line-oriented language. Ruby expressions and statements are terminated at the end of a line unless the statement is obviously incomplete&mdash;for example if the last token on a line is an operator or comma. A semicolon can be used to separate multiple expressions on a line.  You can also put a backslash at the end of a line to continue it onto the next.  Comments start with `#' and run to the end of the physical line. Comments are ignored during compilation.</p>

<div><code class="block">a = 1

b = 2; c = 3

d = 4 + 5 +      # no '\' needed
    6 + 7

e = 8 + 9   \
    + 10         # '\' needed</code></div>
<p>Physical lines between a line starting with <code>=begin</code> and a line starting with <code>=end</code> are ignored by the compiler and may be used for embedded documentation (see Appendix A, &ldquo;<a href="rdtool.html#embeddeddocumentation">Embedded Documentation</a>&rdquo;).</p>
<p>Ruby reads its program input in a single pass, so you can pipe programs to the compiler's <code>stdin</code>.</p>

<div><code class="block">echo 'print "Hello\n"' | ruby</code></div>
<p>If the compiler comes across a line anywhere in the source containing just &ldquo;<code>__END__</code>&rdquo;, with no leading or trailing whitespace, it treats that line as the end of the program&mdash;any subsequent lines will not be compiled. However, these lines can be read into the running program using the global <code class="class">IO</code> object <code class="const"><a href="language.html#globalconstants">DATA</a></code>.</p>

<h3 id="beginandendblocks">BEGIN and END Blocks</h3>
<p>Every Ruby source file can declare blocks of code to be run as the file is being loaded (the <code class="keyword">BEGIN</code> blocks) and after the program has finished executing (the <code class="keyword">END</code> blocks).</p>
<div class="syntax"><code class="block">BEGIN {
  <i class="opt">begin code</i>
}

END {
  <i class="opt">end code</i>
}</code></div>
<p>A program may include multiple <code class="keyword">BEGIN</code> and <code class="keyword">END</code> blocks. <code class="keyword">BEGIN</code> blocks are executed in the order they are encountered. <code class="keyword">END</code> blocks are executed in reverse order.</p>

<h3 id="generaldelimitedinput">General Delimited Input</h3>
<p>There are alternative forms of literal strings, arrays, regular expressions, and shell commands that are specified using a generalized delimited syntax. All these literals start with a percent character, followed by a single character that identifies the literal's type. These characters are summarized in <a href="language.html#table_18.1">Table 18.1</a>; the actual literals are described in the corresponding sections later in this chapter.</p>

<table class="figure" id="table_18.1">
	<caption>Table 18.1 : General delimited input</caption>
	<thead><tr>
	  <th>Type</th>
	  <th>Meaning</th>
	  <th>See Page</th>
	</tr></thead><tbody>
	<tr class="firstRow">
	  <td><code>%q</code></td>
	  <td>Single-quoted string</td>
	  <td><a href="language.html#strings">202</a></td>
	</tr>
	<tr>
	  <td><code>%Q</code>, <code>%</code></td>
	  <td>Double-quoted string</td>
	  <td><a href="language.html#strings">202</a></td>
	</tr>
	<tr>
	  <td><code>%w</code></td>
	  <td>Array of tokens</td>
	  <td><a href="language.html#arrays">204</a></td>
	</tr>
	<tr>
	  <td><code>%r</code></td>
	  <td>Regular expression pattern</td>
	  <td><a href="language.html#regularexpressions">205</a></td>
	</tr>
	<tr>
	  <td><code>%x</code></td>
	  <td>Shell command</td>
	  <td>218</td>
	</tr></tbody>
</table>

<p>Following the type character is a delimiter, which can be any character. If the delimiter is one of the characters &ldquo;<code>(</code>&rdquo;, &ldquo;<code>[</code>&rdquo;, &ldquo;<code>{</code>&rdquo;, or &ldquo;<code>&lt;</code>&rdquo;, the literal consists of the characters up to the matching closing delimiter, taking account of nested delimiter pairs. For all other delimiters, the literal comprises the characters up to the next occurrence of the delimiter character.</p>

<div><code class="block">%q/this is a string/
%q-string-
%q(a (nested) string)</code></div>
<p>Delimited strings may continue over multiple lines.</p>

<div><code class="block">%q{def fred(a)
     a.each { |i| puts i }
   end}</code></div>


<h2 id="thebasictypes">The Basic Types</h2>
<p>The basic types in Ruby are numbers, strings, arrays, hashes, ranges, symbols, and regular expressions.</p>

<h3 id="integerandfloatingpointnumbers">Integer and Floating Point Numbers</h3>
<p>Ruby integers are objects of class <code class="class">Fixnum</code> or <code class="class">Bignum</code>. <code class="class">Fixnum</code> objects hold integers that fit within the native machine word minus 1 bit. Whenever a <code class="class">Fixnum</code> exceeds this range, it is automatically converted to a <code class="class">Bignum</code> object, whose range is effectively limited only by available memory.  If an operation with a <code class="class">Bignum</code> result has a final value that will fit in a <code class="class">Fixnum</code>, the result will be returned as a <code class="class">Fixnum</code>.</p>
<p>Integers are written using an optional leading sign, an optional base indicator (<code>0</code> for octal, <code>0x</code> for hex, or <code>0b</code> for binary), followed by a string of digits in the appropriate base. Underscore characters are ignored in the digit string.</p>
<p>You can get the integer value corresponding to an ASCII character by preceding that character with a question mark.  Control and meta combinations of characters can also be generated using ?\C-<em>x</em>, ?\M-<em>x</em>, and ?\M-\C-<em>x</em>. The control version of <code>ch</code> is <code>ch&amp;0x9f</code>, and the meta version is <code>ch | 0x80</code>. You can get the integer value of a backslash character using the sequence <code>?\\</code>.</p>

<div><code class="block">123456                    # Fixnum
123_456                   # Fixnum (underscore ignored)
-543                      # Negative Fixnum
123_456_789_123_345_789   # Bignum
0xaabb                    # Hexadecimal
0377                      # Octal
-0b1010                   # Binary (negated)
0b001_001                 # Binary
?a                        # character code
?A                        # upper case
?\C-a                     # control a = A - 0x40
?\C-A                     # case ignored for control chars
?\M-a                     # meta sets bit 7
?\M-\C-a                  # meta and control a</code></div>
<p>A numeric literal with a decimal point and/or an exponent is turned into a <code class="class">Float</code> object, corresponding to the native architecture's <code>double</code> data type. You must follow the decimal point with a digit, as <code>1.e3</code> tries to invoke the method <code class="method">e3</code> in class <code class="class">Fixnum</code>.</p>

<div><code class="block">12.34 <span class="output"><span class="outputmark">&rarr;</span> 12.34</span>
-.1234e2 <span class="output"><span class="outputmark">&rarr;</span> -12.34</span>
1234e-2 <span class="output"><span class="outputmark">&rarr;</span> 12.34</span></code></div>


<h4 id="strings">Strings</h4>
<p>Ruby provides a number of mechanisms for creating literal strings. Each generates objects of type <code class="class">String</code>.  The different mechanisms vary in terms of how a string is delimited and how much substitution is done on the literal's content.</p>
<p>Single-quoted string literals (<code>'</code><em>stuff</em><code>'</code> and %q/<em>stuff</em>/) undergo the least substitution. Both convert the sequence <code>\\</code> into a single backslash, and the form with single quotes converts \' into a single quote.</p>

<div><code class="block">'hello' <span class="output"><span class="outputmark">&rarr;</span> hello</span>
'a backslash \'\\\'' <span class="output"><span class="outputmark">&rarr;</span> a backslash '\'</span>
%q/simple string/ <span class="output"><span class="outputmark">&rarr;</span> simple string</span>
%q(nesting (really) works) <span class="output"><span class="outputmark">&rarr;</span> nesting (really) works</span>
%q no_blanks_here ; <span class="output"><span class="outputmark">&rarr;</span> no_blanks_here</span></code></div>


<p>Double-quoted strings ("<em>stuff</em>", %Q/<em>stuff</em>/, and %/<em>stuff</em>/) undergo additional substitutions, shown in <a href="language.html#table_18.2">Table 18.2</a>.</p>
<table class="figure" id="table_18.2">
	<caption>Table 18.2 : Substitutions in double-quoted strings</caption>
	<tr class="firstRow">
	  <td>\a</td>
	  <td>Bell/alert (0x07)</td>
	  <td>\<em>nnn</em></td>
	  <td>Octal <em>nnn</em></td>
	</tr>
	<tr>
	  <td>\b</td>
	  <td>Backspace  (0x08)</td>
	  <td>\x<em>nn</em></td>
	  <td>Hex <em>nn</em></td>
	</tr>
	<tr>
	  <td>\e</td>
	  <td>Escape     (0x1b)</td>
	  <td>\c<em>x</em></td>
	  <td>Control-<em>x</em></td>
	</tr>
	<tr>
	  <td>\f</td>
	  <td>Formfeed   (0x0c)</td>
	  <td>\C-<em>x</em></td>
	  <td>Control-<em>x</em></td>
	</tr>
	<tr>
	  <td>\n</td>
	  <td>Newline    (0x0a)</td>
	  <td>\M-<em>x</em></td>
	  <td>Meta-<em>x</em></td>
	</tr>
	<tr>
	  <td>\r</td>
	  <td>Return     (0x0d)</td>
	  <td>\M-\C-<em>x</em></td>
	  <td>Meta-control-<em>x</em></td>
	</tr>
	<tr>
	  <td>\s</td>
	  <td>Space      (0x20)</td>
	  <td>\<em>x</em></td>
	  <td><em>x</em></td>
	</tr>
	<tr>
	  <td>\t</td>
	  <td>Tab        (0x09)</td>
	  <td>#{expr}</td>
	  <td>Value of <em>expr</em></td>
	</tr>
	<tr>
	  <td>\v</td>
	  <td>Vertical tab (0x0b)</td>
	</tr>
</table>


<div><code class="block">a  = 123
"\123mile" <span class="output"><span class="outputmark">&rarr;</span> Smile</span>
"Say \"Hello\"" <span class="output"><span class="outputmark">&rarr;</span> Say "Hello"</span>
%Q!"I said 'nuts'," I said! <span class="output"><span class="outputmark">&rarr;</span> "I said 'nuts'," I said</span>
%Q{Try #{a + 1}, not #{a - 1}} <span class="output"><span class="outputmark">&rarr;</span> Try 124, not 122</span>
%&lt;Try #{a + 1}, not #{a - 1}&gt; <span class="output"><span class="outputmark">&rarr;</span> Try 124, not 122</span>
"Try #{a + 1}, not #{a - 1}" <span class="output"><span class="outputmark">&rarr;</span> Try 124, not 122</span></code></div>


<p>Strings can continue across multiple input lines, in which case they will contain newline characters. It is also possible to use <em>here   documents</em> to express long string literals. Whenever Ruby parses the sequence <code>&lt;&lt;</code><em>identifier</em> or <code>&lt;&lt;</code><em>quoted string</em>, it replaces it with a string literal built from successive logical input lines. It stops building the string when it finds a line that starts with the identifier or the <em>quoted string</em>.  You can put a minus sign immediately after the &lt;&lt; characters, in which case the terminator can be indented from the left margin.  If a quoted string was used to specify the terminator, its quoting rules will be applied to the here document; otherwise, double-quoting rules apply.</p>

<div><code class="block">a = 123
print &lt;&lt;HERE
Double quoted \
here document.
Sum = #{a + 1}
HERE

print &lt;&lt;-'THERE'
    This is single quoted.
    The above used #{a + 1}
    THERE</code></div>
<p class="produces"><em>produces:</em></p>
<div><code class="block">Double quoted here document.
Sum = 124
    This is single quoted.
    The above used #{a + 1}</code></div>
<p>Adjacent single- and double-quoted strings in the input are concatenated to form a single <code class="class">String</code> object.</p>

<div><code class="block">'Con' "cat" 'en' "ate" <span class="output"><span class="outputmark">&rarr;</span> "Concatenate"</span></code></div>


<p>Strings are stored as sequences of 8-bit bytes, <span class="footnote">(for use in Japan, the <code>jcode</code> library supports a set of operations of strings written with EUC, SJIS, or UTF-8 encoding. The underlying string, however, is still accessed as a series of bytes)</span> and each byte may contain any of the 256 8-bit values, including null and newline. The substitution mechanisms in <a href="language.html#table_18.2">Table 18.2</a> allow nonprinting characters to be inserted conveniently and portably.</p>
<p>Every time a string literal is used in an assignment or as a parameter, a new <code class="class">String</code> object is created.</p>

<div><code class="block">for i in 1..3
  print 'hello'.id, " "
end</code></div>
<p class="produces"><em>produces:</em></p>
<div><code class="block">537765312 537765022 537764992</code></div>
<p>For more information, see the documentation for class <code class="class"><a href="ref_c_string.html#String">String</a></code>.</p>

<h3 id="ranges">Ranges</h3>
<p>Outside the context of a conditional expression, <em>expr</em><code>..</code><em>expr</em> and <em>expr</em><code>...</code><em>expr</em> construct <code class="class">Range</code> objects. The two-dot form is an inclusive range; the one with three dots is a range that excludes its last element. See the description of class <code class="class"><a href="ref_c_range.html#Range">Range</a></code> for details. Also see the description of <a href="language.html#rangesinbooleanexpressions">conditional expressions</a> for other uses of ranges.</p>

<h3 id="arrays">Arrays</h3>
<p>Literals of class <code class="class">Array</code> are created by placing a comma-separated series of object references between square brackets. A trailing comma is ignored.</p>

<div><code class="block">arr = [ fred, 10, 3.14, "This is a string", barney("pebbles"), ]</code></div>
<p>Arrays of strings can be constructed using a shortcut notation, <code>%w</code>, which extracts space-separated tokens into successive elements of the array. A space can be escaped with a backslash. This is a form of general delimited input, described on pages 200&ndash;201.</p>

<div><code class="block">  arr = %w( fred wilma barney betty great\ gazoo )
  arr <span class="output" style="width:34em"><span class="outputmark">&rarr;</span> ["fred", "wilma", "barney", "betty", "great gazoo"]</span></code></div>



<h3 id="hashes">Hashes</h3>
<p>A literal Ruby <code class="class">Hash</code> is created by placing a list of key/value pairs between braces, with either a comma or the sequence <code>=&gt;</code> between the key and the value. A trailing comma is ignored.</p>

<div><code class="block">colors = { "red"   =&gt; 0xf00,
           "green" =&gt; 0x0f0,
           "blue"  =&gt; 0x00f
         }</code></div>
<p>There is no requirement for the keys and/or values in a particular hash to have the same type.</p>

<h4 id="requirementsforahashkey">Requirements for a Hash Key</h4>
<p>The only restriction for a hash key is that it must respond to the message <code class="method">hash</code> with a hash value, and the hash value for a given key must not change. This means that certain classes (such as <code class="class">Array</code> and <code class="class">Hash</code>, as of this writing) can't conveniently be used as keys, because their hash values can change based on their contents.</p>
<p>If you keep an external reference to an object that is used as a key, and use that reference to alter the object and change its hash value, the hash lookup based on that key may not work.</p>
<p>Because strings are the most frequently used keys, and because string contents are often changed, Ruby treats string keys specially. If you use a <code class="class">String</code> object as a hash key, the hash will duplicate the string internally and will use that copy as its key. Any changes subsequently made to the original string will not affect the hash.</p>
<p>If you write your own classes and use instances of them as hash keys, you need to make sure that either (a) the hashes of the key objects don't change once the objects have been created or (b) you remember to call the <code class="class_instance_method"><a href="ref_c_hash.html#Hash.rehash"><span class="class">Hash</span>#<span class="method">rehash</span></a></code> method to reindex the hash whenever a key hash <em>is</em> changed.</p>

<h3 id="symbols">Symbols</h3>
<p>A Ruby symbol is the internal representation of a name. You construct the symbol for a name by preceding the name with a colon. A particular name will always generate the same symbol, regardless of how that name is used within the program.</p>

<div><code class="block">:Object
:myVariable</code></div>
<p>Other languages call this process &ldquo;interning,&rdquo; and call symbols &ldquo;atoms.&rdquo;</p>

<h3 id="regularexpressions">Regular Expressions</h3>
<p>Regular expression literals are objects of type <code class="class">Regexp</code>. They can be created by explicitly calling the <code class="class_class_method"><a href="ref_c_regexp.html#Regexp.new"><span class="class">Regexp</span>.<span class="method">new</span></a></code> constructor, or by using the literal forms, /<em>pattern</em>/ and <code>%r{</code><em>pattern</em><code>}</code>. The <code>%r</code> construct is a form of general delimited input (described on pages 200&ndash;201).</p>
<div class="syntax"><code class="block">/pattern/
/pattern/<i class="opt">options</i>
%r{pattern}
%r{pattern}<i class="opt">options</i>
Regexp.new( 'pattern' <i class="opt">[</i>, <i class="opt">options</i><i class="opt">]</i> )</code></div>

<h4 id="regularexpressionoptions">Regular Expression Options</h4>
<p>A regular expression may include one or more options that modify the way the pattern matches strings. If you're using literals to create the <code class="class">Regexp</code> object, then the options comprise one or more characters placed immediately after the terminator. If you're using <code>Regexp.new</code>, the options are constants used as the second parameter of the constructor.</p>

<table class="figure">
<tr class="firstRow">
  <td><code>i</code></td>
  <td><em>Case Insensitive</em>. The pattern match will ignore
  the case of letters in the pattern and string. Matches are also
  case-insensitive if the global variable <var>$=</var> is set.</td>
</tr>
<tr>
  <td><code>o</code></td>
  <td><em>Substitute Once</em>. Any <code>#{...}</code> substitutions
  in
  a particular regular expression literal will be performed just once,
  the first time it is evaluated. Otherwise, the substitutions
  will be performed every time the literal generates a <code class="class">Regexp</code> object.</td>
</tr>
<tr>
  <td><code>m</code></td>
  <td><em>Multiline Mode</em>. Normally, &ldquo;.&rdquo; matches any
  character except a newline. With the <code>/m</code> option, &ldquo;.&rdquo; matches
  any character.</td>
</tr>
<tr>
  <td><code>x</code></td>
  <td><em>Extended Mode</em>.
  Complex regular expressions can be difficult to read. The `x'
  option
  allows you to insert spaces, newlines, and comments in the pattern to
  make it more readable.</td>
</tr>
</table>

<h4 id="regularexpressionpatterns">Regular Expression Patterns</h4>
<dl>
	<dt><em>regular characters</em></dt>
	<dd>All characters except ., |, (, ), [, \, ^, {, +, $, *, and ? match themselves. To match one of these characters, precede it with a backslash.</dd>

	<dt><code>^</code></dt>
	<dd>Matches the beginning of a line.</dd>

	<dt><code>$</code></dt>
	<dd>Matches the end of a line.</dd>

	<dt><code>\A</code></dt>
	<dd>Matches the beginning of the string.</dd>

	<dt><code>\z</code></dt>
	<dd>Matches the end of the string.</dd>

	<dt><code>\Z</code></dt>
	<dd>Matches the end of the string <em>unless</em> the string ends with a &ldquo;\n&rdquo;, in which case it matches just before the &ldquo;\n&rdquo;.</dd>

	<dt><code>\b</code>, <code>\B</code></dt>
	<dd>Match word boundaries and nonword boundaries respectively.</dd>
	
	<dt><code>[</code><em>characters</em><code>]</code></dt>
	<dd>A character class matches any single character between the brackets.  The characters <code>|, (, ), [, ^, $, *,</code> and <code>?</code>, which have special meanings elsewhere in patterns, lose their special significance between brackets.  The sequences <code>\</code><em>nnn</em>, <code>\x</code><em>nn</em>, <code>\c</code><em>x</em>, <code>\C-</code><em>x</em>, <code>\M-</code><em>x</em>, and <code>\M-\C-</code><em>x</em> have the meanings shown in <a href="language.html#table_18.2">Table 18.2</a>.  The sequences <code>\d</code>, <code>\D</code>, <code>\s</code>, <code>\S</code>, <code>\w</code>, and <code>\W</code> are abbreviations for groups of characters, as shown in <a href="tut_stdtypes.html#table_5.1">Table 5.1</a>.  The sequence c<sub>1</sub>-c<sub>2</sub> represents all the characters between c<sub>1</sub> and c<sub>2</sub>, inclusive. Literal <code>]</code> or <code>-</code> characters must appear immediately after the opening bracket.  An uparrow (^) immediately following the opening bracket negates the sense of the match&mdash;the pattern matches any character that isn't in the character class.</dd>
	
	<dt><code>\d</code>, <code>\s</code>, <code>\w</code></dt>
	<dd>Are abbreviations for character classes that match digits, whitespace, and word characters, respectively. \D, \S, and \W match characters that are not digits, whitespace, or word characters. These abbreviations are summarized in <a href="tut_stdtypes.html#table_5.1">Table 5.1</a>.</dd>
	
	<dt><code>.</code> (period)</dt>
	<dd>Appearing outside brackets, matches any character except a newline. (With the <code>/m</code> option, it matches newline, too).</dd>
	
	<dt><em>re</em><code>*</code></dt>
	<dd>Matches zero or more occurrences of <em>re</em>.</dd>
	
	<dt><em>re</em><code>+</code></dt>
	<dd>Matches one or more occurrences of <em>re</em>.</dd>
	
	<dt><em>re</em><code>{m,n}</code></dt>
	<dd>Matches at least &ldquo;m&rdquo; and at most &ldquo;n&rdquo; occurrences of <em>re</em>.</dd>
	
	<dt><em>re</em><code>?</code></dt>
	<dd>Matches zero or one occurrence of <em>re</em>. The <code>*</code>, <code>+</code>, and <code>{m,n}</code> modifiers are greedy by default. Append a question mark to make them minimal.</dd>
	
	<dt><em>re1</em><code>|</code><em>re2</em></dt>
	<dd>Matches either <em>re1</em> or <em>re2</em>.  <code>|</code> has a low precedence.</dd>
	
	<dt><code>(...)</code></dt>
	<dd>Parentheses are used to group regular expressions. For example, the pattern <code>/abc+/</code> matches a string containing an &ldquo;a,&rdquo; a &ldquo;b,&rdquo; and one or more &ldquo;c&rdquo;s. <code>/(abc)+/</code> matches one or more sequences of &ldquo;abc&rdquo;.  Parentheses are also used to collect the results of pattern matching. For each opening parenthesis, Ruby stores the result of the partial match between it and the corresponding closing parenthesis as successive groups. Within the same pattern, <code>\1</code> refers to the match of the first group, <code>\2</code> the second group, and so on.  Outside the pattern, the special variables <code>$1</code>, <code>$2</code>, and so on, serve the same purpose.</dd>

</dl>

<h4 id="substitutions">Substitutions</h4>
<dl>
<dt><code>#{...}</code></dt>
<dd>Performs an expression substitution, as with strings. By default, the
substitution is performed each time a regular expression literal is
evaluated. With the <code>/o</code> option, it is performed just the first
time.</dd>
<dt><code>\0, \1, \2, ... \9, \&amp;, \`, \', \+</code></dt>
<dd>Substitutes the value matched by the <em>n</em>th grouped
subexpression, or by the entire match, pre- or postmatch, or the
highest group.
</dd></dl>

<h4 id="extensions">Extensions</h4>
<p>In common with Perl and Python, Ruby regular expressions offer some extensions over traditional Unix regular expressions. All the extensions are entered between the characters <code>(?</code> and <code>)</code>. The parentheses that bracket these extensions are groups, but they do not generate backreferences: they do not set the values of <code>\1</code> and <code>$1</code> etc.</p>
<dl>
	<dt><code>(?# <em>comment</em>)</code></dt>
	<dd>Inserts a comment into the pattern. The content is ignored during pattern matching.</dd>
	<dt><code>(?:<em>re</em>)</code></dt>
	<dd>Makes <em>re</em> into a group without generating backreferences. This is often useful when you need to group a set of constructs but don't want the group to set the value of <var>$1</var> or whatever. In the example that follows, both patterns match a date with either colons or spaces between the month, day, and year. The first form stores the separator character in <var>$2</var> and <var>$4</var>, while the second pattern doesn't store the separator in an external variable.
<div><code class="block">date = "12/25/01"
date =~ %r{(\d+)(/|:)(\d+)(/|:)(\d+)}
[$1,$2,$3,$4,$5] <span class="output"><span class="outputmark">&rarr;</span> ["12", "/", "25", "/", "01"]</span>
date =~ %r{(\d+)(?:/|:)(\d+)(?:/|:)(\d+)}
[$1,$2,$3] <span class="output"><span class="outputmark">&rarr;</span> ["12", "25", "01"]</span></code></div>
	</dd>
	
	<dt><code>(?=<em>re</em>)</code></dt>
	<dd>Matches <em>re</em> at this point, but does not consume it (also known charmingly as &ldquo;zero-width positive lookahead&rdquo;). This lets you look forward for the context of a match without affecting <var>$&amp;</var>. In this example, the <code class="method">scan</code> method matches words followed by a comma, but the commas are not included in the result.
	
<div><code class="block">str = "red, white, and blue"
str.scan(/[a-z]+(?=,)/) <span class="output"><span class="outputmark">&rarr;</span> ["red", "white"]</span></code></div>
	</dd>
	
	<dt><code>(?!<em>re</em>)</code></dt>
	<dd>Matches if <em>re</em> does not match at this point. Does not consume the match (zero-width negative lookahead). For example, <code>/hot(?!dog)(\w+)/</code> matches any word that contains the letters &ldquo;hot&rdquo; that aren't followed by &ldquo;dog&rdquo;, returning the end of the word in <var>$1</var>.</dd>
	
	<dt><code>(?&gt;<em>re</em>)</code></dt>
	<dd>Nests an independent regular expression within the first regular expression. This expression is anchored at the current match position. If it consumes characters, these will no longer be available to the higher-level regular expression. This construct therefore inhibits backtracking, which can be a performance enhancement. For example, the pattern <code>/a.*b.*a/</code> takes exponential time when matched against a string containing an &ldquo;a&rdquo; followed by a number of &ldquo;b&rdquo;s, but with no trailing &ldquo;a.&rdquo; However, this can be avoided by using a nested regular expression <code>/a(?&gt;.*b).*a/</code>. In this form, the nested expression consumes all the input string up to the last possible &ldquo;b&rdquo; character. When the check for a trailing &ldquo;a&rdquo; then fails, there is no need to backtrack, and the pattern match fails promptly.
	
<div><code class="block">require "benchmark"
include Benchmark
str = "a" + ("b" * 5000)
bm(8) do |test|
  test.report("Normal:") { str =~ /a.*b.*a/ }
  test.report("Nested:") { str =~ /a(?&gt;.*b).*a/ }
end</code></div>
	<p class="produces"><em>produces:</em></p>
<div><code class="block">			  user     system      total        real
Normal:   0.410000   0.000000   0.410000 (  0.414915)
Nested:   0.000000   0.000000   0.000000 (  0.001190)</code></div>
	</dd>
	
	<dt><code>(?imx)</code></dt>
	<dd>Turns on the corresponding &ldquo;i,&rdquo; &ldquo;m,&rdquo; or &ldquo;x&rdquo; option. If used inside a group, the effect is limited to that group.</dd>
	
	<dt><code>(?-imx)</code></dt>
	<dd>Turns off the &ldquo;i,&rdquo; &ldquo;m,&rdquo; or &ldquo;x&rdquo; option.</dd>
	
	<dt><code>(?imx:<em>re</em>)</code></dt>
	<dd>Turns on the &ldquo;i,&rdquo; &ldquo;m,&rdquo; or &ldquo;x&rdquo; option for <em>re</em>.</dd>
	
	<dt><code>(?-imx:<em>re</em>)</code></dt>
	<dd>Turns off the &ldquo;i,&rdquo; &ldquo;m,&rdquo; or &ldquo;x&rdquo; option for <em>re</em>.</dd>
</dl>

<h2 id="names">Names</h2>
<p>Ruby names are used to refer to constants, variables, methods, classes, and modules. The first character of a name helps Ruby to distinguish its intended use.  Certain names, listed in <a href="language.html#table_18.3">Table 18.3</a>, are reserved words and should not be used as variable, method, class, or module names.</p>
<table class="figure">
	<caption>Reserved words</caption>
	<tr class="firstRow">
	  <td>__FILE__</td>
	  <td>and</td>
	  <td>def</td>
	  <td>end</td>
	  <td>in</td>
	  <td>or</td>
	  <td>self</td>
	  <td>unless</td>
	</tr>
	<tr>
	  <td>__LINE__</td>
	  <td>begin</td>
	  <td>defined?</td>
	  <td>ensure</td>
	  <td>module</td>
	  <td>redo</td>
	  <td>super</td>
	  <td>until</td>
	</tr>
	<tr>
	  <td>BEGIN</td>
	  <td>break</td>
	  <td>do</td>
	  <td>false</td>
	  <td>next</td>
	  <td>rescue</td>
	  <td>then</td>
	  <td>when</td>
	</tr>
	<tr>
	  <td>END</td>
	  <td>case</td>
	  <td>else</td>
	  <td>for</td>
	  <td>nil</td>
	  <td>retry</td>
	  <td>true</td>
	  <td>while</td>
	</tr>
	<tr>
	  <td>alias</td>
	  <td>class</td>
	  <td>elsif</td>
	  <td>if</td>
	  <td>not</td>
	  <td>return</td>
	  <td>undef</td>
	  <td>yield</td>
	</tr>
</table>

<p>In these descriptions, <em>lowercase letter</em> means the characters &ldquo;a&rdquo; though &ldquo;z&rdquo;, as well as &ldquo;_&rdquo;, the underscore. <em>Uppercase   letter</em> means &ldquo;A&rdquo; though &ldquo;Z,&rdquo; and <em>digit</em> means &ldquo;0&rdquo; through &ldquo;9.&rdquo; <em>Name characters</em> means any combination of upper- and lowercase letters and digits.</p>
<p>A local variable name consists of a lowercase letter followed by name characters.</p>

<div><code class="block">fred  anObject  _x  three_two_one</code></div>
<p>An instance variable name starts with an &ldquo;at&rdquo; sign (&ldquo;<code>@</code>&rdquo;) followed by an upper- or lowercase letter, optionally followed by name characters.</p>

<div><code class="block">@name  @_  @Size</code></div>
<p>A class variable name starts with two &ldquo;at&rdquo; signs (&ldquo;<code>@@</code>&rdquo;) followed by an upper- or lowercase letter, optionally followed by name characters.</p>

<div><code class="block">@@name  @@_  @@Size</code></div>
<p>A constant name starts with an uppercase letter followed by name characters. Class names and module names are constants, and follow the constant naming conventions.  By convention, constant variables are normally spelled using uppercase letters and underscores throughout.</p>

<div><code class="block">module Math
  PI = 3.1415926
end
class BigBlob</code></div>

<p>Global variables, and some special system variables, start with a dollar sign (&ldquo;<code>$</code>&rdquo;) followed by name characters. In addition, there is a set of two-character variable names in which the second character is a punctuation character. These predefined variables are listed in the section <a href="language.html#predefinedvariables">Predefined Variables</a>. Finally, a global variable name can be formed using &ldquo;<code>$-</code>&rdquo; followed by <em>any</em> single character.</p>

<div><code class="block">$params  $PROGRAM  $!  $_  $-a  $-.</code></div>

<p>Method names are described in the section &ldquo;<a href="language.html#methoddefinition">Method Definition</a>&rdquo;.</p>

<h3 id="variablemethodambiguity">Variable/Method Ambiguity</h3>
<p>When Ruby sees a name such as &ldquo;a&rdquo; in an expression, it needs to determine if it is a local variable reference or a call to a method with no parameters. To decide which is the case, Ruby uses a heuristic.  As Ruby reads a source file, it keeps track of symbols that have been assigned to. It assumes that these symbols are variables. When it subsequently comes across a symbol that might be either a variable or a method call, it checks to see if it has seen a prior assignment to that symbol. If so, it treats the symbol as a variable; otherwise it treats it as a method call.  As a somewhat pathological case of this, consider the following code fragment, submitted by Clemens Hintze.</p>

<div><code class="block">def a
  print "Function 'a' called\n"
  99
end

for i in 1..2
  if i == 2
    print "a=", a, "\n"
  else
    a = 1
    print "a=", a, "\n"
  end
end</code></div>
<p class="produces"><em>produces:</em></p>
<div><code class="block">a=1
Function 'a' called
a=99</code></div>
<p>During the parse, Ruby sees the use of &ldquo;a&rdquo; in the first print statement and, as it hasn't yet seen any assignment to &ldquo;a,&rdquo; assumes that it is a method call. By the time it gets to the second print statement, though, it <em>has</em> seen an assignment, and so treats &ldquo;a&rdquo; as a variable.</p>
<p>Note that the assignment does not have to be executed&mdash;Ruby just has to have seen it. This program does not raise an error.</p>

<div><code class="block">a = 1 if false; a</code></div>

<h2 id="variablesandconstants">Variables and Constants</h2>
<p>Ruby variables and constants hold references to objects. Variables themselves do not have an intrinsic type.  Instead, the type of a variable is defined solely by the messages to which the object referenced by the variable responds. <span class="footnote">(When we say that a variable   is not typed, we mean that any given variable can at different times   hold references to objects of many different types.)</span></p>
<p>A Ruby <em>constant</em> is also a reference to an object. Constants are created when they are first assigned to (normally in a class or module definition).  Ruby, unlike less flexible languages, lets you alter the value of a constant, although this will generate a warning message.</p>

<div><code class="block">MY_CONST = 1
MY_CONST = 2   # generates a warning</code></div>
<p class="produces"><em>produces:</em></p>
<div><code class="block">prog.rb:2: warning: already initialized constant MY_CONST</code></div>
<p>Note that although constants should not be changed, you can alter the internal states of the objects they reference.</p>

<div><code class="block">MY_CONST = "Tim"
MY_CONST[0] = "J"   # alter string referenced by constant
MY_CONST <span class="output"><span class="outputmark">&rarr;</span> "Jim"</span></code></div>


<p>Assignment potentially <em>aliases</em> objects, giving the same object different names.</p>

<h3 id="scopeofconstantsandvariables">Scope of Constants and Variables</h3>
<p>Constants defined within a class or module may be accessed unadorned anywhere within the class or module. Outside the class or module, they may be accessed using the scope operator, &ldquo;<code>::</code>&rdquo; prefixed by an expression that returns the appropriate class or module object. Constants defined outside any class or module may be accessed unadorned or by using the scope operator &ldquo;<code>::</code>&rdquo; with no prefix. Constants may not be defined in methods.</p>

<div><code class="block">OUTER_CONST = 99
class Const
  def getConst
    CONST
  end
  CONST = OUTER_CONST + 1
end
Const.new.getConst <span class="output"><span class="outputmark">&rarr;</span> 100</span>
Const::CONST <span class="output"><span class="outputmark">&rarr;</span> 100</span>
::OUTER_CONST <span class="output"><span class="outputmark">&rarr;</span> 99</span></code></div>


<p>Global variables are available throughout a program. Every reference to a particular global name returns the same object.  Referencing an uninitialized global variable returns <code>nil</code>.</p>
<p>Class variables are available throughout a class or module body. Class variables must be initialized before use.  A class variable is shared among all instances of a class and is available within the class itself.</p>

<div><code class="block">class Song
  @@count = 0
  def initialize
    @@count += 1
  end
  def Song.getCount
    @@count
  end
end</code></div>
<p>Class variables belong to the innermost enclosing class or module. Class variables used at the top level are defined in <code class="class">Object</code>, and behave like global variables. Class variables defined within singleton methods belong to the receiver if the receiver is a class or a module; otherwise, they belong to the class of the receiver.</p>

<div><code class="block">class Holder
  @@var = 99
  def Holder.var=(val)
    @@var = val
  end
end

a = Holder.new
def a.var
  @@var
end

Holder.var = 123
a.var <span class="output"><span class="outputmark">&rarr;</span> 123</span></code></div>

<p>Instance variables are available within instance methods throughout a class body. Referencing an uninitialized instance variable returns <code>nil</code>. Each instance of a class has a unique set of instance variables. Instance variables are not available to class methods.</p>
<p>Local variables are unique in that their scopes are statically determined but their existence is established dynamically.</p>
<p>A local variable is created dynamically when it is first assigned a value during program execution. However, the scope of a local variable is statically determined to be: the immediately enclosing block, method definition, class definition, module definition, or top-level program. Referencing a local variable that is in scope but that has not yet been created generates a <code class="exception">NameError</code> exception.</p>
<p>Local variables with the same name are different variables if they appear in disjoint scopes.</p>
<p>Method parameters are considered to be variables local to that method.</p>
<p>Block parameters are assigned values when the block is invoked.</p>

<div><code class="block">a = [ 1, 2, 3 ]
a.each { |i|  puts i  }  # i local to block
a.each { |$i| puts $i }  # assigns to global $i
a.each { |@i| puts @i }  # assigns to instance variable @i
a.each { |I|  puts I  }  # generates warning assigning to constant
a.each { |b.meth| }      # invokes meth= in object b
sum = 0
var = nil
a.each { |var| sum += var }  # uses sum and var from enclosing scope</code></div>

<p>If a local variable (including a block parameter) is first assigned in a block, it is local to the block. If instead a variable of the same name is already established at the time the block executes, the block will inherit that variable.</p>
<p>A block takes on the set of local variables in existence at the time that it is created. This forms part of its binding. Note that although the binding of the variables is fixed at this point, the block will have access to the <em>current</em> values of these variables when it executes. The binding preserves these variables even if the original enclosing scope is destroyed.</p>
<p>The bodies of <code>while</code>, <code>until</code>, and <code>for</code> loops are part of the scope that contains them; previously existing locals can be used in the loop, and any new locals created will be available outside the bodies afterward.</p>

<h3 id="predefinedvariables">Predefined Variables</h3>
<p>The following variables are predefined in the Ruby interpreter. In these descriptions, the notation <span class="readonly">[r/o]</span> indicates that the variables are read-only; an error will be raised if a program attempts to modify a read-only variable. After all, you probably don't want to change the meaning of <code>true</code> halfway through your program (except perhaps if you're a politician).  Entries marked <span class="thread">[thread]</span> are thread local.</p>
<p>Many global variables look something like Snoopy swearing: <code>$_</code>, <code>$!</code>, <code>$&amp;</code>, and so on. This is for &ldquo;historical&rdquo; reasons, as most of these variable names come from Perl. If you find memorizing all this punctuation difficult, you might want to have a look at the library file called &ldquo;<a href="lib_standard.html#English">English</a>,&rdquo;, which gives the commonly used global variables more descriptive names.</p>
<p>In the tables of variables and constants that follow, we show the variable name, the type of the referenced object, and a description.</p>


<h4 id="exceptioninformation">Exception Information</h4>
<table>
	<tr class="firstRow">
		<td><code>$!</code></td>
		<td><code class="class">Exception</code></td>
		<td>The exception object passed to <code>raise</code>. <span class="thread">[thread]</span></td>
	</tr><tr>
		<td><code>$@</code></td>
		<td><code class="class">Array</code></td>
		<td>The stack backtrace generated by the last exception. See <code><a href="ref_m_kernel.html#Kernel.caller">Kernel#caller</a></code> for details. <span class="thread">[thread]</span></td>
	</tr>
</table>

<h4 id="patternmatchingvariables">Pattern Matching Variables</h4>
<p>These variables (except <code>$=</code>) are set to <code>nil</code> after an unsuccessful pattern match.</p>
<table>
	<tr class="firstRow">
		<td><code>$&amp;</code></td>
		<td><code class="class">String</code></td>
		<td>The string matched by the last successful pattern match. This variable is local to the current scope. <span class="readonly thread">[r/o, thread]</span></td>
	</tr><tr>
		<td><code>$+</code></td>
		<td><code class="class"><code class="class">String</code></code></td>
		<td>The contents of the highest-numbered group matched in the last successful pattern match. Thus, in <code>"cat" =~/(c|a)(t|z)/</code>, <code>$+</code> will be set to  &ldquo;t&rdquo;.  This variable is local to the current scope. <span class="readonly thread">[r/o, thread]</span></td>
	</tr><tr>
		<td><code>$`</code></td>
		<td><code class="class">String</code></td>
		<td>The string preceding the match in the last successful pattern match. This variable is local to  the current scope. <span class="readonly thread">[r/o, thread]</span></td>
	</tr><tr>
		<td><code>$'</code></td>
		<td><code class="class">String</code></td>
		<td>The string following the match in the last successful pattern match. This variable is local to  the current scope. <span class="readonly thread">[r/o, thread]</span></td>
	</tr><tr>
		<td><code>$=</code></td>
		<td><code class="class">Object</code></td>
		<td>If set to any value apart from <code>nil</code> or <code>false</code>, all pattern matches will be case insensitive, string comparisons will ignore case, and string hash values will be case insensitive.</td>
	</tr><tr>
		<td style="white-space:nowrap"><code>$1</code> to <code>$9</code></td>
		<td><code class="class">String</code></td>
		<td>The contents of successive groups matched in the last successful pattern match.  In <code>"cat" =~/(c|a)(t|z)/</code>, <code>$1</code> will be set to  &ldquo;a&rdquo; and <code>$2</code> to &ldquo;t&rdquo;.  This variable is local to the current scope. <span class="readonly thread">[r/o, thread]</span></td>
	</tr><tr>
		<td><code>$~</code></td>
		<td><code class="class">MatchData</code></td>
		<td>An object that encapsulates the results of a successful pattern match. The variables <code>$&amp;</code>, <code>$`</code>, <code>$'</code>, and <code>$1</code> to <code>$9</code> are all derived from <code>$~</code>. Assigning to <code>$~</code> changes the values of these derived variables.  This variable is local to the current scope. <span class="thread">[thread]</span></td>
	</tr>
</table>

<h4 id="inputoutputvariables">Input/Output Variables</h4>
<table>
	<tr class="firstRow">
		<td><code>$/</code></td>
		<td><code class="class">String</code></td>
		<td>The input record separator (newline by default). This is the value that routines such as <code><a href="ref_m_kernel.html#Kernel.gets">Kernel#gets</a></code> use to determine record boundaries. If set to <code>nil</code>, <code>gets</code> will read  the entire file.</td>
	</tr><tr>
		<td><code>$-0</code></td>
		<td><code class="class">String</code></td>
		<td>Synonym for <code>$/</code>.</td>
	</tr><tr>
		<td><code>$\</code></td>
		<td><code class="class">String</code></td>
		<td>The string appended to the output of every call to methods such as <code><a href="ref_m_kernel.html#Kernel.print">Kernel#print</a></code> and <a href="ref_c_io.html#IO.write"> <code>IO#write</code></a>. The default value is <code>nil</code>.</td>
	</tr><tr>
		<td><code>$,</code></td>
		<td><code class="class">String</code></td>
		<td>The separator string output between the parameters to methods such as <code><a href="ref_m_kernel.html#Kernel.print">Kernel#print</a></code> and <code><a href="ref_c_array.html#Array.join">Array#join</a></code>. Defaults to <code>nil</code>, which adds no text.</td>
	</tr><tr>
		<td><code>$.</code></td>
		<td><code class="class">Fixnum</code></td>
		<td>The number of the last line read from the current input file.</td>
	</tr><tr>
		<td><code>$;</code></td>
		<td><code class="class">String</code></td>
		<td>The default separator pattern used by <code><a href="ref_c_string.html#String.split">String#split</a></code>. May be set from the command line using the <code>-F</code>                    flag.</td>
	</tr><tr>
		<td><code>$&lt;</code></td>
		<td><code class="class">Object</code></td>
		<td>An object that provides access to the concatenation of the contents of all the files given as command-line arguments, or <code>$stdin</code> (in the case where there are no arguments). <code>$&lt;</code> supports methods similar to a  <code class="class">File</code> object: <code>binmode</code>, <code>close</code>, <code>closed?</code>, <code>each</code>, <code>each_byte</code>, <code>each_line</code>, <code>eof</code>, <code>eof?</code>, <code>file</code>, <code>filename</code>, <code>fileno</code>, <code>getc</code>, <code>gets</code>, <code>lineno</code>, <code>lineno=</code>, <code>pos</code>, <code>pos=</code>, <code>read</code>, <code>readchar</code>, <code>readline</code>, <code>readlines</code>, <code>rewind</code>, <code>seek</code>, <code>skip</code>, <code>tell</code>, <code>to_a</code>, <code>to_i</code>, <code>to_io</code>, <code>to_s</code>, along with the methods in <code>Enumerable</code>. The method <code>file</code>  returns a <code class="class">File</code> object for the file currently being read. This may change as <code>$&lt;</code> reads through the files on the command line. <span class="readonly">[r/o]</span></td>
	</tr><tr>
		<td><code>$&gt;</code></td>
		<td><code class="class">IO</code></td>
		<td>The destination of output for <code><a href="ref_m_kernel.html#Kernel.print">Kernel#print</a></code> and <code><a href="ref_m_kernel.html#Kernel.printf">Kernel#printf</a></code>. The default value is <code>$stdout</code>.</td>
	</tr><tr>
		<td><code>$_</code></td>
		<td><code class="class">String</code></td>
		<td>The last line read by <code><a href="ref_m_kernel.html#Kernel.gets">Kernel#gets</a></code> or <code><a href="ref_m_kernel.html#Kernel.readline">Kernel#readline</a></code>. Many string-related functions in the <code>Kernel</code> module operate on <code>$_</code> by default. The variable is local to the current scope. <span class="thread">[thread]</span></td>
	</tr><tr>
		<td><code>$defout</code></td>
		<td><code class="class">IO</code></td>
		<td>Synonym for <code>$&gt;</code>.</td>
	</tr><tr>
		<td><code>$-F</code></td>
		<td><code class="class">String</code></td>
		<td>Synonym for <code>$;</code>.</td>
	</tr><tr>
		<td><code>$stderr</code></td>
		<td><code class="class">IO</code></td>
		<td>The current standard error output.</td>
	</tr><tr>
		<td><code>$stdin</code></td>
		<td><code class="class">IO</code></td>
		<td>The current standard input.</td>
	</tr><tr>
		<td><code>$stdout</code></td>
		<td><code class="class">IO</code></td>
		<td>The current standard output.</td>
	</tr>
</table>

<h4 id="executionenvironmentvariables">Execution Environment Variables</h4>
<table>
	<tr class="firstRow">
		<td><code>$0</code></td>
		<td><code class="class">String</code></td>
		<td>The name of the top-level Ruby program being executed.  Typically this will be the program's filename. On some operating systems, assigning to this variable will change the name of the process reported (for example) by the <code>ps(1)</code> command.</td>
	</tr><tr>
		<td><code>$*</code></td>
		<td><code class="class">Array</code></td>
		<td>An array of strings containing the command-line options from the invocation of the program. Options used by the Ruby interpreter will have been removed. <span class="readonly">[r/o]</span></td>
	</tr><tr>
		<td><code>$"</code></td>
		<td><code class="class">Array</code></td>
		<td>An array containing the filenames of modules loaded by <code>require</code>.
<span class="readonly">[r/o]</span></td>
	</tr><tr>
		<td><code>$$</code></td>
		<td><code class="class">Fixnum</code></td>
		<td>The process number of the program being executed. <span class="readonly">[r/o]</span></td>
	</tr><tr>
		<td><code>$?</code></td>
		<td><code class="class">Fixnum</code></td>
		<td>The exit status of the last child process to terminate. <span class="readonly thread">[r/o, thread]</span></td>
	</tr><tr>
		<td><code>$:</code></td>
		<td><code class="class">Array</code></td>
		<td>An array of strings, where each string specifies a directory to be searched for Ruby scripts and binary extensions used by the <code>load</code> and <code>require</code> methods. The initial value is the  value of the arguments passed via the <code>-I</code> command-line option, followed by an installation-defined standard library location, followed by the current directory (&ldquo;.&rdquo;). This variable may be set  from within a program to alter the default search path; typically, programs use <code>$: &lt;&lt; dir</code> to append <code>dir</code> to the path. <span class="readonly">[r/o]</span></td>
	</tr><tr>
		<td><code>$-a</code></td>
		<td><code class="class">Object</code></td>
		<td>True if the <code>-a</code> option is specified on the  command line. <span class="readonly">[r/o]</span></td>
	</tr><tr>
		<td><code>$-d</code></td>
		<td><code class="class">Object</code></td>
		<td>Synonym for <code>$DEBUG</code>.</td>
	</tr><tr>
		<td><code>$DEBUG</code></td>
		<td><code class="class">Object</code></td>
		<td>Set to <code>true</code> if the <code>-d</code> command-line  option is specified.</td>
	</tr><tr>
		<td><code>__FILE__</code></td>
		<td><code class="class">String</code></td>
		<td>The name of the current source file. <span class="readonly">[r/o]</span></td>
	</tr><tr>
		<td><code>$F</code></td>
		<td><code class="class">Array</code></td>
		<td>The array that receives the split input line if the <code>-a</code> command-line option is used.</td>
	</tr><tr>
		<td><code>$FILENAME</code></td>
		<td><code class="class">String</code></td>
		<td>The name of the current input file. Equivalent to <code>$&lt;.filename</code>. <span class="readonly">[r/o]</span></td>
	</tr><tr>
		<td><code>$-i</code></td>
		<td><code class="class">String</code></td>
		<td>If in-place edit mode is enabled (perhaps using the  <code>-i</code> command-line option), <code>$-i</code> holds the extension used when creating the backup file. If you set a value into <code>$-i</code>, enables in-place edit mode. See &ldquo;<a href="rubyworld.html#commandlineoptions">Command-line Options</a>&rdquo;.</td>
	</tr><tr>
		<td><code>$-I</code></td>
		<td><code class="class">Array</code></td>
		<td>Synonym for <code>$:</code>. <span class="readonly">[r/o]</span></td>
	</tr><tr>
		<td><code>$-K</code></td>
		<td><code class="class">String</code></td>
		<td>Sets the multibyte coding system for strings and regular expressions. Equivalent to the <code>-K</code> command-line option. See &ldquo;<a href="rubyworld.html#commandlineoptions">Command-line Options</a>&rdquo;.</td>
	</tr><tr>
		<td><code>$-l</code></td>
		<td><code class="class">Object</code></td>
		<td>Set to <code>true</code> if the <code>-l</code> option (which enables line-end processing) is present on the command line. See &ldquo;<a href="rubyworld.html#commandlineoptions">Command-line Options</a>&rdquo;. <span class="readonly">[r/o]</span></td>
	</tr><tr>
		<td><code>__LINE__</code></td>
		<td><code class="class">String</code></td>
		<td>The current line number in the source file. <span class="readonly">[r/o]</span></td>
	</tr><tr>
		<td><code>$LOAD_PATH</code></td>
		<td><code class="class">Array</code></td>
		<td>A synonym for <code>$:</code>. <span class="readonly">[r/o]</span></td>
	</tr><tr>
		<td><code>$-p</code></td>
		<td><code class="class">Object</code></td>
		<td>Set to <code>true</code> if the <code>-p</code> option (which puts an implicit <code>while gets</code> ... <code>end</code> loop around your program) is present on the command line. See &ldquo;<a href="rubyworld.html#commandlineoptions">Command-line Options</a>&rdquo;. <span class="readonly">[r/o]</span></td>
	</tr><tr>
		<td><code>$SAFE</code></td>
		<td><code class="class">Fixnum</code></td>
		<td>The current safe level (see &ldquo;<a href="taint.html#safelevels">Safe Levels</a>&rdquo;). This variable's value may never be reduced by assignment. <span class="thread">[thread]</span></td>
	</tr><tr>
		<td><code>$VERBOSE</code></td>
		<td><code class="class">Object</code></td>
		<td>Set to <code>true</code> if the <code>-v</code>, <code>--version</code>, or <code>-w</code>  option is specified on the command line. Setting this option to <code>true</code> causes the interpreter and some library routines to report additional information.</td>
	</tr><tr>
		<td><code>$-v</code></td>
		<td><code class="class">Object</code></td>
		<td>Synonym for <code>$VERBOSE</code>.</td>
	</tr><tr>
		<td><code>$-w</code></td>
		<td><code class="class">Object</code></td>
		<td>Synonym for <code>$VERBOSE</code>.</td>
	</tr>
</table>


<h4 id="standardobjects">Standard Objects</h4>
<table>
	<tr class="firstRow">
		<td><code>ARGF</code></td>
		<td><code class="class">Object</code></td>
		<td>A synonym for <code>$&lt;</code>.</td>
	</tr><tr>
		<td><code>ARGV</code></td>
		<td><code class="class">Array</code></td>
		<td>A synonym for <code>$*</code>.</td>
	</tr><tr>
		<td><code>ENV</code></td>
		<td><code class="class">Object</code></td>
		<td>A hash-like object containing the program's environment variables. An instance of class <code class="class">Object</code>, <code>ENV</code> implements the full set of <code class="class">Hash</code> methods. Used  to query and set the value of an environment variable, as in <code>ENV["PATH"]</code> and <code>ENV['term']="ansi"</code>.</td>
	</tr><tr>
		<td><code>false</code></td>
		<td><code class="class">FalseClass</code></td>
		<td>Singleton instance of class <code class="class">FalseClass</code>. <span class="readonly">[r/o]</span></td>
	</tr><tr>
		<td><code>nil</code></td>
		<td><code class="class">NilClass</code></td>
		<td>The singleton instance of class <code class="class">NilClass</code>. The value of uninitialized instance and global variables. <span class="readonly">[r/o]</span></td>
	</tr><tr>
		<td><code>self</code></td>
		<td><code class="class">Object</code></td>
		<td>The receiver (object) of the current method. <span class="readonly">[r/o]</span></td>
	</tr><tr>
		<td><code>true</code></td>
		<td><code class="class">TrueClass</code></td>
		<td>Singleton instance of class <code class="class">TrueClass</code>. <span class="readonly">[r/o]</span></td>
	</tr>
</table>


<h4 id="globalconstants">Global Constants</h4>
<p>The following constants are defined by the Ruby interpreter.</p>
<table>
	<tr class="firstRow">
		<td><code>DATA</code></td>
		<td><code class="class">IO</code></td>
		<td>If the main program file contains the directive <code>__END__</code>,   then the constant <code>DATA</code> will be initialized so that reading from it will return lines following <code>__END__</code> from the source file.</td>
	</tr><tr>
		<td><code>FALSE</code></td>
		<td><code class="class">FalseClass</code></td>
		<td>Synonym for <code>false</code>.</td>
	</tr><tr>
		<td><code>NIL</code></td>
		<td><code class="class">NilClass</code></td>
		<td>Synonym for <code>nil</code>.</td>
	</tr><tr>
		<td><code>RUBY_PLATFORM</code></td>
		<td><code class="class">String</code></td>
		<td>The identifier of the platform running this program. This string is in the same form as the platform identifier used by the GNU configure utility (which is not a coincidence).</td>
	</tr><tr>
		<td><code>RUBY_RELEASE_DATE</code></td>
		<td><code class="class">String</code></td>
		<td>The date of this release.</td>
	</tr><tr>
		<td><code>RUBY_VERSION</code></td>
		<td><code class="class">String</code></td>
		<td>The version number of the interpreter.</td>
	</tr><tr>
		<td><code>STDERR</code></td>
		<td><code class="class">IO</code></td>
		<td>The actual standard error stream for the program. The initial value of <code>$stderr</code>.</td>
	</tr><tr>
		<td><code>STDIN</code></td>
		<td><code class="class">IO</code></td>
		<td>The actual standard input stream for the program. The initial value of <code>$stdin</code>.</td>
	</tr><tr>
		<td><code>STDOUT</code></td>
		<td><code class="class">IO</code></td>
		<td>The actual standard output stream for the program. The initial value of <code>$stdout</code>.</td>
	</tr><tr>
		<td><code>TOPLEVEL_BINDING</code></td>
		<td><code class="class">Binding</code></td>
		<td>A <code>Binding</code> object representing the binding at Ruby's top level&mdash;the level where programs are initially executed.</td>
	</tr><tr>
		<td><code>TRUE</code></td>
		<td><code class="class">TrueClass</code></td>
		<td>Synonym for <code>true</code>.</td>
	</tr>
</table>



<h2 id="expressions">Expressions</h2>

<h3 id="singleterms">Single Terms</h3>
<p>Single terms in an expression may be any of the following.</p>
<ul>
<li><b>Literal</b>. Ruby literals are numbers, strings, arrays, hashes, ranges, symbols, and regular expressions. There are described in the &ldquo;<a href="language.html#thebasictypes">The Basic Types</a>&rdquo;.</li>
<li><b>Shell Command</b>.  A shell command is a string enclosed in backquotes, or in <a href="language.html#generaldelimitedinput">a general delimited string</a> starting with <code>%x</code>. The value of the string is the standard output of running the command represented by the string under the host operating system's standard shell. The execution also sets the <code>$?</code> variable with the command's exit status.
<div><code class="block">filter = "*.c"
files = `ls #{filter}`
files = %x{ls #{filter}}</code></div>
</li>
<li><b>Symbol Generator</b>. A <code class="class">Symbol</code> object is created by prefixing an operator, variable, constant, method, class, or module name with a colon.  The symbol object will be unique for each different name but does not refer to a particular instance of the name, so the symbol for (say) <code>:fred</code> will be the same regardless of context. A symbol is similar to the concept of atoms in other high-level languages.</li>
<li><b>Variable Reference</b> or <b>Constant Reference</b>. A variable is referenced by citing its name. Depending on scope (see &ldquo;<a href="language.html#scopeofconstantsandvariables">Scope of Constants and Variables</a>&rdquo;), a constant is referenced either by citing its name or by qualifying the name, using the name of the class or module containing the constant and the scope operator (&ldquo;<code>::</code>&rdquo;).
<div><code class="block">barney    # variable reference
APP_NAMR  # constant reference
Math::PI  # qualified constant reference</code></div>
</li>
<li><b>Method Invocation</b>. The various ways of invoking a method are described starting in &ldquo;<a href="language.html#invokingamethod">Invoking a Method</a>&rdquo;.</li>
</ul>


<h3 id="operatorexpressions">Operator Expressions</h3>

<p>Expressions may be combined using operators. <a href="language.html#table_18.4">Table 18.4</a> lists the Ruby operators in precedence order. The operators with a Y in the <em>method</em> column are implemented as methods, and may be overridden.</p>

<table id="table_18.4">
	<caption>Table 18.4 : Ruby operators (high to low precedence)</caption>  
	<thead><tr>
		<th>Method</th>
		<th>Operator</th>
		<th>Description</th>
	</tr></thead><tbody>
	<tr class="firstRow">
			<td>Y</td>
		<td><code>[ ]</code> <code>[ ]=</code></td>
		<td>Element reference, element set</td>
	</tr><tr>
		<td>Y</td>
		<td><code>**</code></td>
		<td>Exponentiation</td>
	</tr><tr>
		<td>Y</td>
		<td><code>!</code> <code>~</code> <code>+</code> <code>-</code></td>
		<td>Not, complement, unary plus and minus (method names for the last two are <code>+@</code> and <code>-@</code>)</td>
	</tr><tr>
		<td>Y</td>
		<td><code>*</code> <code>/</code> <code>%</code></td>
		<td>Multiply, divide, and modulo</td>
	</tr><tr>
		<td>Y</td>
		<td><code>+</code> <code>-</code></td>
		<td>Plus and minus</td>
	</tr><tr>
		<td>Y</td>
		<td><code>&gt;&gt;</code> <code>&lt;&lt;</code></td>
		<td>Right and left shift</td>
	</tr><tr>
		<td>Y</td>
		<td><code>&amp;</code></td>
		<td>Bitwise `and'</td>
	</tr><tr>
		<td>Y</td>
		<td><code>^</code> <code>|</code></td>
		<td>Bitwise exclusive `or' and regular `or'</td>
	</tr><tr>
		<td>Y</td>
		<td><code>&lt;=</code> <code>&lt;</code> <code>&gt;</code> <code>&gt;=</code></td>
		<td>Comparison operators</td>
	</tr><tr>
		<td>Y</td>
		<td><code>&lt;=&gt;</code> <code>==</code> <code>===</code> <code>!=</code> <code>=~</code> <code>!~</code></td>
		<td>Equality and pattern match operators (<code>!=</code> and <code>!~</code> may not be defined as methods)</td>
	</tr><tr>
		<td></td>
		<td><code>&amp;&amp;</code></td>
		<td>Logical `and'</td>
	</tr><tr>
		<td></td>
		<td><code>||</code></td>
		<td>Logical `or'</td>
	</tr><tr>
		<td></td>
		<td><code>..</code> <code>...</code></td>
		<td>Range (inclusive and exclusive)</td>
	</tr><tr>
		<td></td>
		<td><code>? :</code></td>
		<td>Ternary if-then-else</td>
	</tr><tr>
		<td></td>
		<td><code>=</code> <code>%=</code> <code></code>{ <code>/=</code> <code>-=</code> <code>+=</code> <code>|=</code> <code>&amp;=</code> <code>&gt;&gt;=</code> <code>&lt;&lt;=</code> <code>*=</code> <code>&amp;&amp;=</code> <code>||=</code> <code>**=</code></td>
		<td>Assignment</td>
	</tr><tr>
		<td></td>
		<td><code>defined?</code></td>
		<td>Check if symbol defined</td>
	</tr><tr>
		<td></td>
		<td><code>not</code></td>
		<td>Logical negation</td>
	</tr><tr>
		<td></td>
		<td><code>or</code> <code>and</code></td>
		<td>Logical composition</td>
	</tr><tr>
		<td></td>
		<td><code>if</code> <code>unless</code> <code>while</code> <code>until</code></td>
		<td>Expression modifiers</td>
	</tr><tr>
		<td></td>
		<td><code>begin/end</code></td>
		<td>Block expression</td>
	</tr></tbody>
</table>


<h3 id="moreonassignment">More on Assignment</h3>
<p>The assignment operator assigns one or more <em>rvalues</em> to one or more <em>lvalues</em>. What is meant by assignment depends on each individual lvalue.</p>
<p>If an lvalue is a variable or constant name, that variable or constant  receives a reference to the corresponding rvalue.</p>
<div><code class="block">a, b, c = 1, "cat", [ 3, 4, 5 ]</code></div>
<p>If the lvalue is an object attribute, the corresponding attribute setting method will be called in the receiver, passing as a parameter the rvalue.</p>
<div><code class="block">anObj = A.new
anObj.value = "hello"   # equivalent to anObj.value=("hello")</code></div>
<p>If the lvalue is an array element reference, Ruby calls the element assignment operator (&ldquo;<code>[]=</code>&rdquo;) in the receiver, passing as parameters any indices that appear between the brackets followed by the rvalue.  This is illustrated in <a href="language.html#table_18.5">Table 18.5</a>.</p>

<table id="table_18.5">
	<caption>Table 18.5 : Mapping from element reference to method call</caption>
	<thead><tr>
	<th>Element Reference</th>
	<th>Actual Method Call</th>
	</tr></thead><tbody><tr class="firstRow">
		<td><code>anObj[]  = "one"</code></td>
		<td><code>anObj.[]=("one")</code></td>
	</tr><tr>
		<td><code>anObj[1] = "two"</code></td>
		<td><code>anObj.[]=(1, "two")</code></td>
	</tr><tr>
		<td><code>anObj["a", /^cat/] = "three"</code></td>
		<td><code>anObj.[]=("a", /^cat/, "three")</code></td>
	</tr></tbody>
</table>



<h3 id="parallelassignment">Parallel Assignment</h3>
<p>An assignment expression may have one or more lvalues and one or more rvalues. This section explains how Ruby handles assignment with different combinations of arguments.</p>
<ol>
	<li>If the last rvalue is prefixed with an asterisk and is an object of class <code class="class">Array</code>, the rvalue is replaced with the elements of the array, with each element forming its own rvalue.</li>
	<li>If the assignment contains multiple lvalues and one rvalue, the rvalue is converted into an <code class="class">Array</code>, and this array is expanded into a set of rvalues as described in (1).</li>
	<li>Successive rvalues are assigned to the lvalues. This assignment effectively happens in parallel, so that (for example) <code>a,b=b,a</code> swaps the values in &ldquo;a&rdquo; and &ldquo;b.&rdquo;</li>
	<li>If there are more lvalues than rvalues, the excess will have <code>nil</code> assigned to them.</li>
	<li>If there are more rvalues that lvalues, the excess will be ignored.</li>
	<li>These rules are modified slightly if the last lvalue is preceded with an asterisk. This lvalue will always receive an array during the assignment. The array will consist of whatever rvalue would normally have been assigned to this lvalue, followed by the excess rvalues (if any).</li>
	<li>If an lvalue is a parenthesized list, it is treated as a nested assignment statement, and the list is assigned from the corresponding rvalue as described by these rules.</li>
</ol>
<p>The tutorial has examples in the section &ldquo;<a href="tut_expressions.html#parallelassignment">Parallel Assignment</a>&rdquo;.</p>


<h3 id="blockexpressions">Block Expressions</h3>
<div><code class="block">begin
  <i>body</i>
end</code></div>
<p>Expressions may be grouped between <code>begin</code> and <code>end</code>. The value of the block expression is the value of the last expression executed.</p>
<p>Block expressions also play a role in exception handling, which is discussed in &ldquo;<a href="language.html#handlingexceptions">Handling Exceptions</a>&rdquo;.</p>


<h3 id="booleanexpressions">Boolean Expressions</h3>
<p>Boolean expressions evaluate to a truth value. Some Ruby constructs (particularly ranges) behave differently when evaluated in a boolean expression.</p>

<h4 id="truthvalues">Truth Values</h4>
<p>Ruby predefines the globals <code>false</code> and <code>nil</code>. Both of these values are treated as being false in a boolean context. All other values are treated as being true.</p>

<h4 id="andornotanddefined">And, Or, Not, and Defined?</h4>
<p>The <code>and</code> and <code>&amp;&amp;</code> operators evaluate their first operand. If false, the expression returns false; otherwise, the expression returns the value of the second operand.</p>
<div><code class="block"><i>expr1</i>  and  <i>expr2</i>
<i>expr1</i>  &amp;&amp;   <i>expr2</i></code></div>
<p>The <code>or</code> and <code>||</code> operators evaluate their first operand. If true, the expression returns true; otherwise, the expression returns the value of the second operand.</p>
<div><code class="block"><i>expr1</i>  or  <i>expr2</i>
<i>expr1</i>  ||  <i>expr2</i></code></div>
<p>The <code>not</code> and <code>!</code> operators evaluate their operand. If true, the expression returns false. If false, the expression returns true.</p>
<p>The word forms of these operators (<code>and</code>, <code>or</code>, and <code>not</code>) have a lower precedence than the corresponding symbol forms (<code>&amp;&amp;</code>, <code>||</code>, and <code>!</code>). See <a href="language.html#table_18.4">Table 18.4</a> for details.</p>
<p>The <code>defined?</code> operator returns <code>nil</code> if its argument, which can be an arbitrary expression, is not defined. Otherwise, it returns a description of that argument. For examples, see the &ldquo;<a href="tut_expressions.html#definedandorandnot">Defined?, And, Or, and Not</a>&rdquo; section in the tutorial.</p>

<h4 id="comparisonoperators">Comparison Operators</h4>
<p>The Ruby syntax defines the comparison operators <code>==</code>, <code>===</code>, <code>&lt;=&gt;</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>=~</code>, and the standard  methods <code>eql?</code> and <code>equal?</code> (see <a href="tut_expressions.html#table_7.1">Table 7.1</a>). All of these operators are implemented as methods.  Although the operators have intuitive meaning, it is up to the classes that implement them to produce meaningful comparison semantics. The <a href="builtins.html">library reference</a> describes the comparison semantics for the built-in classes. The module <code>Comparable</code> provides support for implementing the operators <code>==</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, and the method <code>between?</code> in terms of <code>&lt;=&gt;</code>. The operator <code>===</code> is used in <code>case</code> expressions, described in the section &ldquo;<a href="language.html#caseexpressions">Case Expressions</a>&rdquo;.</p>
<p>Both <code>==</code> and <code>=~</code> have negated forms, <code>!=</code> and <code>!~</code>. Ruby converts these during syntax analysis: <code>a!=b</code> is mapped to <code>!(a==b)</code>, and <code>a!~b</code> is mapped to <code>!(a =~b)</code>. There are no methods corresponding to <code>!=</code> and <code>!~</code>.</p>


<h4 id="rangesinbooleanexpressions">Ranges in Boolean Expressions</h4>

<div><code class="block">if  <i>expr1</i> .. <i>expr2</i>
while  <i>expr1</i> ... <i>expr2</i></code></div>

<p>A range used in a boolean expression acts as a flip-flop. It has two states, set and unset, and is initially unset. On each call, the range cycles through the state machine shown in <a href="language.html#figure_18.1">Figure 18.1</a>. The range returns <code>true</code> if it is in the set state at the end of the call, and <code>false</code> otherwise.</p>

<div class="figure" id="figure_18.1">Figure 18.1 not available...</div>

<p>The two-dot form of a range behaves slightly differently than the three-dot form. When the two-dot form first makes the transition from unset to set, it immediately evaluates the end condition and makes the transition accordingly. This means that if <em>expr1</em> and <em>expr2</em> both evaluate to <code>true</code> on the same call, the two-dot form will finish the call in the unset state. However, it still returns <code>true</code> for this call.</p>
<p>The difference is illustrated by the following code:</p>

<div><code class="block">a = (11..20).collect {|i| (i%4 == 0)..(i%3 == 0) ? i : nil}
a <span class="output" style="width:31em"><span class="outputmark">&rarr;</span> [nil, 12, nil, nil, nil, 16, 17, 18, nil, 20]</span>

a = (11..20).collect {|i| (i%4 == 0)...(i%3 == 0) ? i : nil}
a <span class="output" style="width:31em"><span class="outputmark">&rarr;</span> [nil, 12, 13, 14, 15, 16, 17, 18, nil, 20]</span></code></div>


<h4 id="regularexpressionsinbooleanexpressions">Regular Expressions in Boolean Expressions</h4>
<p>If a single regular expression appears as a boolean expression, it is matched against the current value of the variable <code>$_</code>.</p>
<div><code class="block">if /re/ ...</code></div>

<p class="produces"><em>is equivalent to</em></p>

<div><code class="block">if $_ =~ /re/ ...</code></div>



<h3 id="ifandunlessexpressions">If and Unless Expressions</h3>

<div><code class="block">if <i>boolean-expression</i> <i>[</i> then <i>]</i>
  <i>body</i>
elsif <i>boolean-expression</i> <i>[</i> then <i>]</i>
  <i>body</i>
else
  <i>body</i>
end</code></div>

<div><code class="block">unless <i>boolean-expression</i> <i>[</i> then <i>]</i>
  <i>body</i>
else
  <i>body</i>
end</code></div>

<p>The <code>then</code>  keyword separates the body from the condition. It is not required if the body starts on a new line. The value of an <code>if</code> or <code>unless</code> expression is the value of the last expression evaluated in whichever body is executed.</p>

<h4 id="ifandunlessmodifiers">If and Unless Modifiers</h4>
<div><code class="block"><i>expression</i> if     <i>boolean-expression</i>
<i>expression</i> unless <i>boolean-expression</i></code></div>
<p>evaluates <em>expression</em> only if <em>boolean-expression</em> is <code>true</code> (<code>false</code> for <code>unless</code>).</p>


<h3 id="ternaryoperator">Ternary Operator</h3>
<div><code class="block"><i>boolean-expression</i> ? <i>expr1</i> : <i>expr2</i></code></div>
<p>returns <em>expr1</em> if <em>boolean-expression</em> is true and <em>expr2</em> otherwise.</p>


<h3 id="caseexpressions">Case Expressions</h3>
<div><code class="block">case <i>target</i>
  when <i>comparison</i> <i>[</i>, <i>comparison</i> <i>]*</i> <i>[</i> then <i>]</i>
    <i>body</i>
  when <i>comparison</i> <i>[</i>, <i>comparison</i> <i>]*</i> <i>[</i> then <i>]</i>
    <i>body</i>
  ...
<i>[</i> else
    <i>body</i> <i>]</i>
 end</code></div>
<p>A case expression searches for a match by starting at the first (top left) comparison, performing <em>comparison</em> <code>===</code> <em>target</em>. When a comparison returns true, the search stops, and the body associated with the comparison is executed. <code>case</code> then returns the value of the last expression executed.  If no <em>comparison</em> matches: if an <code>else</code> clause is present, its body will be executed; otherwise, <code>case</code> silently returns <code>nil</code>.</p>
<p>The <code>then</code> keyword separates the <code>when</code> comparisons from the bodies, and is not needed if the body starts on a new line.</p>


<h3 id="loops">Loops</h3>
<div><code class="block">while <i>boolean-expression</i> <i>[</i> do <i>]</i>
  <i>body</i>
end</code></div>
<p>executes <em>body</em> zero or more times as long as <em>boolean-expression</em> is true.</p>
<div><code class="block">until <i>boolean-expression</i> <i>[</i> do <i>]</i>
  <i>body</i>
end</code></div>
<p>executes <em>body</em> zero or more times as long as <em>boolean-expression</em> is false.</p>
<p>In both forms, the <code>do</code> separates <em>boolean-expression</em> from the <em>body</em>, and may be omitted when the body starts on a new line.</p>
<div><code class="block">for name <i>[</i>, <i>name</i> <i>]</i>+ in <i>expression</i> <i>[</i> do <i>]</i>
  <i>body</i>
end</code></div>
<p>The <code>for</code> loop is executed as if it were the following <code>each</code> loop, except that local variables defined in the body of the <code>for</code> loop will be available outside the loop, while those defined within an iterator block will not.</p>
<div><code class="block"><i>expression</i>.each do | name <i>[</i>, <i>name</i> <i>]</i>+ |
  <i>body</i>
end</code></div>
<p><code>loop</code>, which iterates its associated block, is not a language construct&mdash;it is a method in module <code>Kernel</code>.</p>


<h4 id="whileanduntilmodifiers">While and Until Modifiers</h4>
<div><code class="block"><i>expression</i> while <i>boolean-expression</i>
<i>expression</i> until <i>boolean-expression</i></code></div>
<p>If <em>expression</em> is anything other than a <code>begin</code>/<code>end</code> block, executes <em>expression</em> zero or more times while <em>boolean-expression</em> is <code>true</code> (<code>false</code> for <code>until</code>).</p>
<p>If <em>expression</em> is a <code>begin</code>/<code>end</code> block, the block will always be executed at least one time.</p>

<h4 id="breakredonextandretry">Break, Redo, Next, and Retry</h4>
<p><code>break</code>, <code>redo</code>, <code>next</code>, and <code>retry</code> alter the normal flow through a <code>while</code>, <code>until</code>, <code>for</code>, or iterator controlled loop.</p>
<p><code>break</code> terminates the immediately enclosing loop&mdash;control resumes at the statement following the block.  <code>redo</code> repeats the loop from the start, but without reevaluating the condition or fetching the next element (in an iterator).  <code>next</code> skips to the end of the loop, effectively starting the next iteration. <code>retry</code> restarts the loop, reevaluating the condition.</p>



<h2 id="methoddefinition">Method Definition</h2>
<div><code class="block">def <i>defname</i> <i>[</i> ( <i>[</i> <i>arg</i> <i>[</i>=<i>val</i><i>], ...</i> <i>]</i> <i>[</i>, *<i>vararg</i> <i>]</i> <i>[</i>, &amp;<i>blockarg</i> <i>]</i> ) <i>]</i>
  <i>body</i>
end</code></div>
<p><i>defname</i> is both the name of the method and optionally the context in which it is valid.</p>
<div><code class="block"><i>defname</i>  &larr;  <i>methodname</i>
             <i>expr</i>.<i>methodname</i></code></div>
<p>A <i>methodname</i> is either a redefinable operator (see <a href="language.html#table_18.4">Table 18.4</a>) or a name. If <i>methodname</i> is a name, it should start with a lowercase letter (or underscore) optionally followed by upper- and lowercase letters, underscores, and digits. A <i>methodname</i> may optionally end with a question mark (&ldquo;<code>?</code>&rdquo;), exclamation point (&ldquo;<code>!</code>&rdquo;), or equals sign (&ldquo;<code>=</code>&rdquo;). The question mark and exclamation point are simply part of the name. The equals sign is also part of the name but additionally signals that this method is an attribute setter (described in the section &ldquo;<a href="tut_classes.html#writableattributes">Writable Attributes</a>&rdquo;).</p>
<p>A method definition using an unadorned method name within a class or module definition creates an instance method. An instance method may be invoked only by sending its name to a receiver that is an instance of the class that defined it (or one of that class's subclasses).</p>
<p>Outside a class or module definition, a definition with an unadorned method name is added as a private method to class <code class="class">Object</code>, and hence may be called in any context without an explicit receiver.</p>
<p>A definition using a method name of the form <i>expr</i>.<i>methodname</i> creates a method associated with the object that is the value of the expression; the method will be callable only by supplying the object referenced by the expression as a receiver. Other Ruby documentation calls these methods <em>singleton methods</em>.</p>
<div><code class="block">class MyClass
  def MyClass.method      # definition
  end
end

MyClass.method            # call

anObject = Object.new
def anObject.method       # definition
end
anObject.method           # call

def (1.class).fred        # receiver may be an expression
end
Fixnum.fred               # call</code></div>
<p>Method definitions may not contain class, module, or instance method definitions. They may contain nested singleton method definitions. The body of a method acts as if it were a <code>begin</code>/<code>end</code> block, in that it may contain exception handling statements (<code>rescue</code>, <code>else</code>, and <code>ensure</code>).</p>



<h3 id="methodarguments">Method Arguments</h3>
<p>A method definition may have zero or more regular arguments, an optional array argument, and an optional block argument. Arguments are  separated by commas, and the argument list may be enclosed in parentheses.</p>
<p>A regular argument is a local variable name, optionally followed by an  equals sign and an expression giving a default value. The expression is evaluated at the time the method is called. The expressions are evaluated from left to right. An expression may reference a parameter that precedes it in the argument list.</p>

<div><code class="block">def options(a=99, b=a+1)
  [ a, b ]
end
options <span class="output"><span class="outputmark">&rarr;</span> [99, 100]</span>
options 1 <span class="output"><span class="outputmark">&rarr;</span> [1, 2]</span>
options 2, 4 <span class="output"><span class="outputmark">&rarr;</span> [2, 4]</span></code></div>

<p>The optional array argument must follow any regular arguments and may  not have a default.</p>
<p>When the method is invoked, Ruby sets the array argument to reference a new object of class <code class="class">Array</code>. If the method call specifies any parameters in excess of the regular argument count, all these extra parameters will be collected into this newly created array.</p>

<div><code class="block">def varargs(a, *b)
  [ a, b ]
end
varargs 1 <span class="output"><span class="outputmark">&rarr;</span> [1, []]</span>
varargs 1, 2 <span class="output"><span class="outputmark">&rarr;</span> [1, [2]]</span>
varargs 1, 2, 3 <span class="output"><span class="outputmark">&rarr;</span> [1, [2, 3]]</span></code></div>

<p>If an array argument follows arguments with default values, parameters  will first be used to override the defaults. The remainder will then be used to populate the array.</p>

<div><code class="block">def mixed(a, b=99, *c)
  [ a, b, c]
end
mixed 1 <span class="output"><span class="outputmark">&rarr;</span> [1, 99, []]</span>
mixed 1, 2 <span class="output"><span class="outputmark">&rarr;</span> [1, 2, []]</span>
mixed 1, 2, 3 <span class="output"><span class="outputmark">&rarr;</span> [1, 2, [3]]</span>
mixed 1, 2, 3, 4 <span class="output"><span class="outputmark">&rarr;</span> [1, 2, [3, 4]]</span></code></div>

<p>The optional block argument must be the last in the list. Whenever the method is called, Ruby checks for an associated block. If a block is present, it is converted to an object of class <code class="class">Proc</code> and assigned to the block argument. If no block is present, the argument is set to <code>nil</code>.</p>




<h2 id="invokingamethod">Invoking a Method</h2>
<div><code class="block"><i>[</i> <i>receiver</i>.  <i>]</i> <i>name</i> <i>[</i> <i>parameters</i> <i>]</i> <i>[</i> <i>block</i> <i>]</i>
<i>[</i> <i>receiver</i>:: <i>]</i> <i>name</i> <i>[</i> <i>parameters</i> <i>]</i> <i>[</i> <i>block</i> <i>]</i>

<i>parameters</i>  &larr;  ( <i>[</i> <i>param</i>, ...<i>]</i> <i>[</i>, <i>hashlist</i> <i>]</i> <i>[</i> *<i>array</i> <i>]</i> <i>[</i> &amp;<i>aProc</i> <i>]</i> )
<i>block</i>       &larr;  { <i>blockbody</i> }
                do <i>blockbody</i> end</code></div>

<p>Initial parameters are assigned to the actual arguments of the method. Following these parameters may be a list of <em>key</em> <code>=&gt;</code> <em>value</em> pairs. These pairs are collected into a single new <code class="class">Hash</code> object and passed as a single parameter.</p>
<p>Following these parameters may be a single parameter prefixed with an asterisk. If this parameter is an array, Ruby replaces it with zero  or more parameters corresponding to the elements of the array.</p>
<div><code class="block">def regular(a, b, *c)
  # ..
end
regular 1, 2, 3, 4
regular(1, 2, 3, 4)
regular(1, *[2, 3, 4])</code></div>
<p>A block may be associated with a method call using either a literal block (which must start on the same source line as the last line of the method call) or a parameter containing a reference to a <code class="class">Proc</code> or <code class="class">Method</code> object prefixed with an ampersand character. Regardless of the presence of a block argument, Ruby arranges for the value of the global function <code><a href="ref_m_kernel.html#Kernel.block_given_qm">Kernel::block_given?</a></code>  to reflect the availability of a block associated with the call.</p>

<div><code class="block">aProc   = proc { 99 }
anArray = [ 98, 97, 96 ]

def block
  yield
end
block { }
block do
      end
block(&amp;aProc)

def all(a, b, c, *d, &amp;e)
  puts "a = #{a}"
  puts "b = #{b}"
  puts "c = #{c}"
  puts "d = #{d}"
  puts "block = #{yield(e)}"
end

all('test', 1 =&gt; 'cat', 2 =&gt; 'dog', *anArray, &amp;aProc)</code></div>
<p class="produces"><em>produces:</em></p>
<div><code class="block">a = test
b = {1=&gt;"cat", 2=&gt;"dog"}
c = 98
d = [97, 96]
block = 99</code></div>

<p>A method is called by passing its name to a receiver. If no receiver is specified, <code>self</code> is assumed.</p>
<p>The receiver checks for the method definition in its own class and then sequentially in its ancestor classes. The instance methods of included modules act as if they were in anonymous superclasses of the class that includes them. If the method is not found, Ruby invokes the method <code>method_missing</code> in the receiver. The default behavior defined in <code><a href="ref_m_kernel.html#Kernel.method_missing">Kernel::method_missing</a></code> is to report an error and terminate the program.</p>
<p>When a receiver is explicitly specified in a method invocation, it may be separated from the method name using either a period &ldquo;<code>.</code>&rdquo; or two colons &ldquo;<code>::</code>&rdquo;. The only difference between these two forms occurs if the method name starts with an uppercase letter. In this case, Ruby will assume that a <code>receiver::Thing</code> method call is actually an attempt to access a constant called <code>Thing</code> in the receiver <em>unless</em> the method invocation has a parameter list between parentheses.</p>
<div><code class="block">Foo.Bar()         #  method call
Foo.Bar           #  method call
Foo::Bar()        #  method call
Foo::Bar          #  constant access</code></div>
<p>The return value of a method is the value of the last expression executed.</p>
<div><code class="block">return <i>[</i> <i>expr</i>, ... <i>]</i></code></div>

<p>A <code>return</code> expression immediately exits a method. The value of a <code>return</code> is <code>nil</code> if it is called with no parameters, the value of its parameter if it is called with one parameter, or an array containing all of its parameters if it is called with more than one parameter.</p>


<h3 id="super">super</h3>
<div><code class="block">super  <i>[</i> ( <i>[</i> <i>param</i>, ... <i>]</i> <i>[</i> *<i>array</i> <i>]</i> ) <i>]</i>  <i>[</i> <i>block</i> <i>]</i></code></div>
<p>Within the body of a method, a call to <code>super</code> acts just like a call to that original method, except that the search for a method body starts in the superclass of the object that was found to contain the original method. If no parameters (and no parentheses) are passed to <code>super</code>, the original method's parameters will be passed; otherwise, the parameters to <code>super</code> will be passed.</p>


<h3 id="operatormethods">Operator Methods</h3>
<div><code class="block"><i>expr1</i> <i>operator</i>
<i>operator</i> <i>expr1</i>
<i>expr1</i> <i>operator</i> <i>expr2</i></code></div>
<p>If the operator in an operator expression corresponds to a redefinable method (see <a href="language.html#table_18.4">Table 18.4</a>), Ruby will execute the  operator expression as if it had been written</p>
<div><code class="block">(<i>expr1</i>).<i>operator</i>(<i>expr2</i>)</code></div>

<h3 id="attributeassignment">Attribute Assignment</h3>
<div><code class="block"><i>receiver</i>.<i>attrname</i> = <i>rvalue</i></code></div>
<p>When the form <i>receiver</i>.<i>attrname</i> appears as an lvalue, Ruby invokes a method named <i>attrname=</i> in the receiver, passing <i>rvalue</i>  as a single parameter.</p>

<h3 id="elementreferenceoperator">Element Reference Operator</h3>
<div><code class="block"><i>receiver</i> <i>[</i> <i>expr</i> <i>[</i>, <i>expr</i> <i>]*</i> <i>]</i>
<i>receiver</i> <i>[</i> <i>expr</i> <i>[</i>, <i>expr</i> <i>]*</i> <i>]</i> = <i>rvalue</i></code></div>
<p>When used as an rvalue, element reference invokes the method <code>[]</code> in the receiver, passing as parameters the expressions between the brackets.</p>
<p>When used as an lvalue, element reference invokes the method <code>[]=</code> in the receiver, passing as parameters the expressions between the brackets, followed by the <i>rvalue</i> being assigned.</p>



<h2 id="aliasing">Aliasing</h2>
<div><code class="block">alias <i>newName</i> <i>oldName</i></code></div>
<p>creates a new name that refers to an existing method, operator, global variable, or regular expression backreference (<code>$&amp;</code>, <code>$'</code>, <code>$'</code>, and <code>$+</code>). Local variables, instance variables, class variables, and constants may not be aliased. The parameters to <code>alias</code> may be names or symbols.</p>

<div><code class="block">class Fixnum
  alias plus +
end
1.plus(3) <span class="output"><span class="outputmark">&rarr;</span> 4</span>

alias $prematch $`
"string" =~ /i/ <span class="output"><span class="outputmark">&rarr;</span> 3</span>
$prematch <span class="output"><span class="outputmark">&rarr;</span> "str"</span>

alias :cmd :`
cmd "date" <span class="output"><span class="outputmark">&rarr;</span> "Sun Nov 25 23:44:19 CST 2001\n"</span></code></div>

<p>When a method is aliased, the new name refers to a copy of the original method's body. If the method is subsequently redefined, the aliased name will still invoke the original implementation.</p>

<div><code class="block">def meth
  "original method"
end

alias original meth

def meth
  "new and improved"
end
meth <span class="output"><span class="outputmark">&rarr;</span> "new and improved"</span>
original <span class="output"><span class="outputmark">&rarr;</span> "original method"</span></code></div>



<h2 id="classdefinition">Class Definition</h2>
<div><code class="block">class <i>classname</i>  <i>[</i> &lt; <i>superexpr</i> <i>]</i>
  <i>body</i>
end

class &lt;&lt; <i>anObject</i>
  <i>body</i>
end</code></div>

<p>A Ruby class definition creates or extends an object of class <code class="class">Class</code> by executing the code in <i>body</i>. In the first form, a named class is created or extended. The resulting <code class="class">Class</code> object is assigned to a global constant named <i>classname</i>. This name should start with an uppercase letter.  In the second form, an anonymous (singleton) class is associated with the specific object.</p>
<p>If present, <i>superexpr</i> should be an expression that evaluates to a <code class="class">Class</code> object that will be installed as the superclass of the class being defined. If omitted, it defaults to class <code class="class">Object</code>.</p>
<p>Within <i>body</i>, most Ruby expressions are simply executed as the definition is read. However:</p>

<ul>
<li>Method definitions will register the methods in a table in the class object.</li>
<li>Nested class and module definitions will be stored in constants within the class, not as global constants. These nested classes and modules can be accessed from outside the defining class using &ldquo;<code>::</code>&rdquo; to qualify their names.
<div><code class="block">module NameSpace
  class Example
    CONST = 123
  end
end
obj = NameSpace::Example.new
a = NameSpace::Example::CONST</code></div>
</li>
<li>The <code><a href="ref_c_module.html#Module.include">Module#include</a></code> method will add the named modules as anonymous superclasses of the class being defined.</li>
    </ul>
<p>It is worth emphasizing that a class definition is executable code. Many of the directives used in class definition (such as <code>attr</code> and <code>include</code>) are actually simply private instance methods of class <code class="class"><a href="ref_c_module.html">Module</a></code>.</p>
<p>Chapter 19, &ldquo;<a href="classes.html">Classes and Objects</a>&rdquo;, describes in more detail how <code class="classame">Class</code> objects interact with the rest of the environment.</p>


<h3 id="creatingobjectsfromclasses">Creating Objects from Classes</h3>
<div><code class="block"><i>obj</i> = <i>classexpr</i>.new <i>[</i> ( <i>[</i> <i>args</i>, ... <i>]</i> ) <i>]</i></code></div>
<p>Class <code>Class</code> defines the instance method <code><a href="ref_c_class.html#Class.new">Class#new</a></code>, which:</p>

<ul>
	<li>Creates an object of the class of the receiver (<i>classexpr</i> in the syntax example).</li>
	<li>Sets that object's type to be the receiver.</li>
	<li>Invokes the instance method <code>initialize</code> in the newly created object, passing it any arguments originally passed to <code>new</code>.</li>
</ul>
<p>If a class definition overrides the class method <code>new</code> without calling <code>super</code>, no objects of that class can be created.</p>

<h3 id="classattributedeclarations">Class Attribute Declarations</h3>
<p>Class attribute declarations are technically not part of the Ruby language: they are simply methods defined in class <code class="class">Module</code> that create accessor methods automatically.</p>
<div><code class="block">class <i>name</i>
  attr <i>attribute</i>  <i>[</i>, <i>writable</i> <i>]</i>
  attr_reader    <i>attribute</i> <i>[</i>, <i>attribute</i> <i>]*</i>
  attr_writer    <i>attribute</i> <i>[</i>, <i>attribute</i> <i>]*</i>
  attr_accessor  <i>attribute</i> <i>[</i>, <i>attribute</i> <i>]*</i>
end</code></div>


<h2 id="moduledefinitions">Module Definitions</h2>
<div><code class="block">module <i>name</i>
  <i>body</i>
end</code></div>
<p>A module is basically a class that cannot be instantiated. Like a class, its body is executed during definition and the resulting <code class="classame">Module</code> object is stored in a constant. A module may contain class and instance methods and may define constants and class variables. As with classes, module methods are invoked using the <code class="classame">Module</code> object as a receiver, and constants are accessed using the &ldquo;<code>::</code>&rdquo; scope resolution operator.</p>
<div><code class="block">module Mod
  CONST = 1
  def Mod.method1    # module method
    CONST + 1
  end
end

Mod::CONST <span class="output"><span class="outputmark">&rarr;</span> 1</span>
Mod.method1 <span class="output"><span class="outputmark">&rarr;</span> 2</span></code></div>


<h3 id="mixinsincludingmodules">Mixins&mdash;Including Modules</h3>
<div><code class="block">class|module <i>name</i>
  include <i>expr</i>
end</code></div>
<p>A module may be included within the definition of another module or class using the <code>include</code> method. The module or class definition containing the <code>include</code> gains access to the constants, class variables, and instance methods of the module it includes.</p>
<p>If a module is included within a class definition, the module's constants, class variables, and instance methods are effectively bundled into an anonymous (and inaccessible) superclass for that class. In particular, objects of the class will respond to messages sent to the module's instance methods.</p>
<p>A module may also be included at the top level, in which case the module's constants, class variables, and instance methods become available at the top level.</p>


<h3 id="modulefunctions">Module Functions</h3>
<p>Although <code>include</code> is useful for providing mixin functionality,  it is also a way of bringing the constants, class variables, and instance methods of a module into another namespace. However, functionality defined in an instance method will not be available as a  module method.</p>
<div><code class="block">module Math
  def sin(x)
    #
  end
end

# Only way to access Math.sin is...
include Math
sin(1)</code></div>
<p>The method <code><a href="ref_c_module.html#Module.module_function">Module#module_function</a></code> solves this problem by taking one or  more module instance methods and copying their definitions into corresponding module methods.</p>
<div><code class="block">module Math
  def sin(x)
    #
  end
  module_function :sin
end

Math.sin(1)
include Math
sin(1)</code></div>
<p>The instance method and module method are two different methods: the method definition is copied by <code>module_function</code>,  not aliased.</p>



<h2 id="accesscontrol">Access Control</h2>
<p>Ruby defines three levels of protection for module and class constants and methods:</p>

<ul>
	<li><b>Public</b>. Accessible to anyone.</li>
	<li><b>Protected</b>. Can be invoked only by objects of the defining class and its subclasses.</li>
	<li><b>Private</b>. Can be called only in functional form (that is, with an implicit <code>self</code> as the receiver). Private methods  therefore can be called only in the defining class and by direct descendents within the same object.</li>
</ul>
<div><code class="block">private    <i>[</i> <i>aSymbol</i>, ... <i>]</i>
protected  <i>[</i> <i>aSymbol</i>, ... <i>]</i>
public     <i>[</i> <i>aSymbol</i>, ... <i>]</i></code></div>
<p>Each function can be used in two different ways.</p>
<ol>
	<li>If used with no arguments, the three functions set the default access control of subsequently defined methods.</li>
	<li>With arguments, the functions set the access control of the named methods and constants.</li>
</ol>

<p>Access control is enforced when a method is invoked.</p>



<h2 id="blocksclosuresandprocobjects">Blocks, Closures, and Proc Objects</h2>
<p>A code block is a set of Ruby statements and expressions between braces or a <code>do</code>/<code>end</code> pair. The block may start with an argument list between vertical bars. A code block may appear only immediately after a  method invocation. The start of the block must be on the same logical line as the end of the invocation.</p>
<div><code class="block"><i>invocation</i>  do  | a1, a2, ... |
end

<i>invocation</i>  {   | a1, a2, ... |
}</code></div>
<p>Braces have a high precedence; <code>do</code> has a low precedence.  If the method invocation has parameters that are not enclosed in parentheses, the brace form of a block will bind to the last parameter, not to the overall invocation. The <code>do</code> form will bind to the invocation.</p>
<p>Within the body of the invoked method, the code block may be called using the <code>yield</code> method. Parameters passed to the <code>yield</code> will be assigned to arguments in the block using the rules of <a href="language.html#parallelassignment">parallel assignment</a>. The return value of the <code>yield</code> is the value of the last expression evaluated in the block.</p>
<p>A code block remembers the environment in which it was defined, and it uses that environment whenever it is called.</p>


<h3 id="procobjects">Proc Objects</h3>
<p>Code blocks are converted into objects of class <code class="classame">Proc</code> using the methods <code><a href="ref_c_proc.html#Proc.new">Proc.new</a></code> and <code><a href="ref_m_kernel.html#Kernel.proc">Kernel#proc</a></code>, or by associating the block with a method's block argument.</p>
<p>The <code class="classame">Proc</code> constructor takes an associated block and wraps it with enough context to be able to re-create the block's environment when it is subsequently called. The <code><a href="ref_c_proc.html#Proc.call">Proc#call</a></code> instance method then allows you to invoke the original block, optionally passing in parameters. The code in the block (and the associated closure)  remains available for the lifetime of the <code class="classame">Proc</code> object.</p>
<p>If the last argument in a method's argument list is prefixed with an ampersand (&ldquo;<code>&amp;</code>&rdquo;), any block associated with calls to that method will be converted to a <code class="classame">Proc</code> object and assigned to that parameter.</p>



<h2 id="exceptions">Exceptions</h2>
<p>Ruby exceptions are objects of class <code class="classame">Exception</code> and its descendents (a full list of the built-in exceptions is given in <a href="ref_c_exception.html#figure_22.1">Figure  22.1</a>).</p>


<h3 id="raisingexceptions">Raising Exceptions</h3>
<p>The <code><a href="ref_m_kernel.html#Kernel.raise">Kernel::raise</a></code> method raises an exception.</p>
<div><code class="block">raise
raise <i>aString</i>
raise <i>thing</i> <i>[</i>, <i>aString</i> <i>[</i> <i>aStackTrace</i> <i>]</i> <i>]</i></code></div>
<p>The first form reraises the exception in <code>$!</code> or a new <code class="classame">RuntimeError</code> if <code>$!</code> is <code>nil</code>. The second form creates a new <code class="classame">RuntimeError</code> exception, setting its  message to the given string. The third form creates an exception object by invoking the method <code>exception</code> on its first argument. It then sets this exception's message and backtrace to its second and third arguments. Class <code class="classame">Exception</code> and objects of class <code class="classame">Exception</code> contain factory  methods called <code>exception</code>, so an exception class name or instance can be used as the first parameter to <code>raise</code>.</p>
<p>When an exception is raised, Ruby places a reference to the <code class="classame">Exception</code> object in the global variable <code>$!</code>.</p>


<h3 id="handlingexceptions">Handling Exceptions</h3>
<p>Exceptions may be handled within the scope of a <code>begin</code>/<code>end</code> block.</p>
<div><code class="block">  begin
    <i>code...</i>
    <i>code...</i>
<i>[</i> rescue  <i>[</i>parm<i>, ...]</i> <i>[</i> =&gt; <i>var</i> <i>]</i> <i>[</i> then <i>]</i>
    <i>error handling code...</i> <i>]*</i>
<i>[</i> else
    <i>no exception code...</i> <i>]</i>
<i>[</i> ensure
    <i>always executed code...</i> <i>]</i>
  end</code></div>
<p>A block may have multiple <code>rescue</code> clauses, and each <code>rescue</code> clause may specify zero or more parameters. A <code>rescue</code> clause with no parameter is treated as if it had a parameter of <code class="classame">StandardError</code>.</p>
<p>When an exception is raised, Ruby scans up the call stack until it finds an enclosing <code>begin</code>/<code>end</code> block.  For each <code>rescue</code> clause in that block, Ruby compares the raised exception against each of the rescue clause's parameters in turn; each parameter is tested using <code>$!.kind_of?(<em>parameter</em>)</code>.  If the raised exception matches a <code>rescue</code> parameter, Ruby executes the body of the <code>rescue</code> and stops looking.  If a matching <code>rescue</code> clause ends with <code>=&gt;</code> and a variable name, the variable is set to <code>$!</code>.</p>
<p>Although the parameters to the <code>rescue</code> clause are typically the names of <code class="classame">Exception</code> classes, they can actually be arbitrary expressions (including method calls) that return an appropriate class.</p>
<p>If no rescue clause matches the raised exception, Ruby moves up the stack frame looking for a higher-level <code>begin</code>/<code>end</code> block that matches. If an exception propagates to the top level without being rescued, the program terminates with a message.</p>
<p>If an <code>else</code> clause is present, its body is executed if no exceptions were raised in <em>initial code</em>. Exceptions raised during the execution of the <code>else</code> clause are not captured by <code>rescue</code> clauses in the same block as the <code>else</code>.</p>
<p>If an <code>ensure</code> clause is present, its body is always executed as the block is exited (even if an uncaught exception is in the process of being propagated).</p>

<h3 id="retryingablock">Retrying a Block</h3>
<p>The <code>retry</code> statement can be used within a <code>rescue</code>  clause to restart the enclosing <code>begin</code>/<code>end</code> block from the beginning.</p>


<h2 id="catchandthrow">Catch and Throw</h2>
<p>The method <code><a href="ref_m_kernel.html#Kernel.catch">Kernel::catch</a></code> executes its associated block.</p>
<div><code class="block">catch ( <i>aSymbol</i> | <i>aString</i> )  do
  <i>block...</i>
end</code></div>
<p>The method <code><a href="ref_m_kernel.html#Kernel.throw">Kernel::throw</a></code> interrupts the normal processing of statements.</p>
<div><code class="block">throw( <i>aSymbol</i> | <i>aString</i> <i>[</i>, <i>anObject</i> <i>]</i> )</code></div>
<p>When a <code>throw</code> is executed, Ruby searches up the call stack for the  first <code>catch</code> block with a matching symbol or string. If it is found, the search stops, and execution resumes past the end of the <code>catch</code>'s block. If the <code>throw</code> was passed a second parameter, that value  is returned as the value of the <code>catch</code>. Ruby honors the <code>ensure</code> clauses of any block expressions it traverses while looking for a corresponding <code>catch</code>.</p>
<p>If no <code>catch</code> block matches the <code>throw</code>, Ruby raises a <code class="classame">NameError</code> exception at the location of the <code>throw</code>.</p>



<div id="menubot" class="menu">
	<a href="ext_ruby.html" class="prev">&lt; Previous</a><a href="classes.html" class="next">Next &gt;</a>
	<a href="frameset.html" class="contents" target="_top">^Contents^</a>
</div>

<div id="copyright">
	<p>Extracted from the book "Programming Ruby -  The Pragmatic Programmer's Guide"</p>
	<p>Copyright &copy; 2001 by Addison Wesley Longman, Inc. This material may be distributed only subject to the terms and conditions set forth in the Open Publication License, v1.0 or later (the latest version is presently available at <a href="http://www.opencontent.org/openpub/">http://www.opencontent.org/openpub/</a>).</p>
	<p>Distribution of substantively modified versions of this document is prohibited without the explicit permission of the copyright holder.</p>
	<p>Distribution of the work or derivative of the work in any standard (paper) book form is prohibited unless prior permission is obtained from the copyright holder.</p>
</div>

<a href="language.html" target="_top" id="expand" title="Show this content in its own window" onclick="this.href=window.location.href"><img src="includes/expand.png" alt="Show this content in its own window" width="15" height="15"></a>
<script type="text/javascript">
	if (top==self && document.getElementById){
		ex = document.getElementById('expand');
		img = ex.getElementsByTagName('img')[0];
		ex.title=img.alt="Show this content alongside the Table of Contents";
		ex.onclick=function(){ return true }
		ex.href="frameset.html?content="+escape(self.location.href);
		img.src="includes/collapse.png";
	}
</script>
</body>
</html>
